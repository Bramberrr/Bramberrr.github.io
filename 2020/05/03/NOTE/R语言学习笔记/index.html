<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>R语言学习笔记 | Bramber</title><meta name="keywords" content="computer science,data science"><meta name="author" content="Zhiwei Xu"><meta name="copyright" content="Zhiwei Xu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="R语言学习笔记该笔记来源于课程 PH125.8x: Data Science: Machine Learning 相关证书：  I 基本操作一、赋值语句12a &lt;- 1b &lt;- 1  &lt;-用来给变量赋值。 也可以使用&#x3D;代替来分配值&lt;-，但尽量不要使用&#x3D;以避免混淆。 要查看存储在变量中的值，只需让R求值a，它就会显示存储的值： 12a#&gt; [1] 1  要求R显示存储的">
<meta property="og:type" content="article">
<meta property="og:title" content="R语言学习笔记">
<meta property="og:url" content="http://example.com/2020/05/03/NOTE/R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Bramber">
<meta property="og:description" content="R语言学习笔记该笔记来源于课程 PH125.8x: Data Science: Machine Learning 相关证书：  I 基本操作一、赋值语句12a &lt;- 1b &lt;- 1  &lt;-用来给变量赋值。 也可以使用&#x3D;代替来分配值&lt;-，但尽量不要使用&#x3D;以避免混淆。 要查看存储在变量中的值，只需让R求值a，它就会显示存储的值： 12a#&gt; [1] 1  要求R显示存储的">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/img/R.png">
<meta property="article:published_time" content="2020-05-03T08:04:44.000Z">
<meta property="article:modified_time" content="2022-02-02T08:25:39.139Z">
<meta property="article:author" content="Zhiwei Xu">
<meta property="article:tag" content="computer science">
<meta property="article:tag" content="data science">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/R.png"><div class="dengl"><div class="d-box"><div class="d1"><span></span><span><p></p></span><ul><li></li><li> </li><li><span></span></li><li> </li><li> </li></ul></div><div class="d2"><span></span><span><p></p></span><ul><li></li><li> </li><li><span></span></li><li> </li><li> </li></ul></div></div><div class="d-box1"><div class="d1"><span></span><span><p></p></span><ul><li></li><li> </li><li><span></span></li><li> </li><li> </li></ul></div><div class="d2"><span></span><span><p></p></span><ul><li></li><li> </li><li><span></span></li><li> </li><li>  </li></ul></div></div></div><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2020/05/03/NOTE/R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'R语言学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-02-02 16:25:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhheo/JS-Heo@main/bb/showbb_in_index.css"><link rel="stylesheet" href="/css/bber.css" type="text/css" ><link rel="stylesheet" href="/self/Kimbiedark.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="iron-container iron-circle"><div class="iron-box1 iron-circle iron-center"></div><div class="iron-box2 iron-circle iron-center"></div><div class="iron-box3 iron-circle iron-center"></div><div class="iron-box4 iron-circle iron-center"></div><div class="iron-box5 iron-circle iron-center"></div><div class="iron-box6 iron-circle"><div class="iron-coil" style="--i: 0"></div><div class="iron-coil" style="--i: 1"></div><div class="iron-coil" style="--i: 2"></div><div class="iron-coil" style="--i: 3"></div><div class="iron-coil" style="--i: 4"></div><div class="iron-coil" style="--i: 5"></div><div class="iron-coil" style="--i: 6"></div><div class="iron-coil" style="--i: 7"></div></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">5</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-star-and-crescent"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/bb/"><i class="fa-fw fas fa-paper-plane"></i><span> Tree Hole</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i><span> Comments</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: transparent"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Bramber</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-star-and-crescent"></i><span> Gallery</span></a></div><div class="menus_item"><a class="site-page" href="/bb/"><i class="fa-fw fas fa-paper-plane"></i><span> Tree Hole</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i><span> Comments</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">R语言学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-05-03T08:04:44.000Z" title="Created 2020-05-03 16:04:44">2020-05-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-02-02T08:25:39.139Z" title="Updated 2022-02-02 16:25:39">2022-02-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/NOTE/">NOTE</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="R语言学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="R语言学习笔记"><a href="#R语言学习笔记" class="headerlink" title="R语言学习笔记"></a><p align="center">R语言学习笔记</p></h1><p>该笔记来源于课程 <em>PH125.8x: Data Science: Machine Learning</em></p>
<p>相关证书：</p>
<p><img src="/2020/05/03/NOTE/R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/certificate.png" alt="certificate"></p>
<h2 id="I-基本操作"><a href="#I-基本操作" class="headerlink" title="I 基本操作"></a>I 基本操作</h2><h3 id="一、赋值语句"><a href="#一、赋值语句" class="headerlink" title="一、赋值语句"></a>一、赋值语句</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">a &lt;- 1<br>b &lt;- 1<br></code></pre></td></tr></table></figure>

<p><code>&lt;-</code>用来给变量赋值。</p>
<p>也可以使用<code>=</code>代替来分配值<code>&lt;-</code>，但尽量不要使用<code>=</code>以避免混淆。</p>
<p>要查看存储在变量中的值，只需让R求值<code>a</code>，它就会显示存储的值：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">a<br><span class="hljs-comment">#&gt; [1] 1</span><br></code></pre></td></tr></table></figure>

<p>要求R显示存储的值，更明确的方法是使用<code>print</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">print(a)<br><span class="hljs-comment">#&gt; [1] 1</span><br></code></pre></td></tr></table></figure>

<h3 id="二、在工作区操作"><a href="#二、在工作区操作" class="headerlink" title="二、在工作区操作"></a>二、在工作区操作</h3><p>在控制台中定义对象时，实际上是在更改<em>工作空间</em>。</p>
<p>键入以下命令查看保存在工作空间中的所有变量：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">ls()<br><span class="hljs-comment">#&gt; [1] &quot;a&quot;        &quot;b&quot;        &quot;c&quot;        &quot;dat&quot;      &quot;img_path&quot; &quot;murders&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="三、预定义函数"><a href="#三、预定义函数" class="headerlink" title="三、预定义函数"></a>三、预定义函数</h3><p>定义变量后，通常可以将数据分析过程描述为应用于数据的一系列函数。R包含几个预定义的函数：</p>
<p><code>install.packages</code>，<code>library</code>，<code>ls</code>，<code>sqrt</code> ……</p>
<p>也可以通过软件包添加更多函数，这些函数未出现在工作空间中，但可以立即使用。</p>
<p>eg：如果键入<code>ls</code>，则不评估该函数，而是显示定义该函数的代码。</p>
<p>如果键入<code>ls()</code>，则将对其求值，将在工作空间中看到对象。</p>
<p>与<code>ls</code>不同，大多数函数都需要一个或多个<em>参数</em>。</p>
<p>eg: <code>log</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">log</span>(<span class="hljs-number">8</span>)<br><span class="hljs-comment">#&gt; [1] 2.08</span><br><span class="hljs-built_in">log</span>(a) <br><span class="hljs-comment">#&gt; [1] 0</span><br></code></pre></td></tr></table></figure>

<p>可以使用<code>help</code>功能来获得帮助：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">help(<span class="hljs-string">&quot;log&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>对于大多数功能，我们还可以使用以下缩写：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">?<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure>

<p>帮助页面将向您显示函数期望的参数。某些参数是必需的，而其他参数是可选的。可以通过在帮助文档中指定默认值来确定哪些参数是可选的。<code>=</code>是可选的,比如<code>log</code>默认的<code>base = exp(1)</code>。</p>
<p>快速查看参数而不打开帮助系统，可以键入：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">args(<span class="hljs-built_in">log</span>)<br><span class="hljs-comment">#&gt; function (x, base = exp(1)) </span><br><span class="hljs-comment">#&gt; NULL</span><br></code></pre></td></tr></table></figure>

<p>通过分配另一个对象来更改默认值：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">log</span>(<span class="hljs-number">8</span>, base = <span class="hljs-number">2</span>)<br><span class="hljs-comment">#&gt; [1] 3</span><br></code></pre></td></tr></table></figure>

<p>如果未使用任何参数名称，R按照帮助文件中显示的顺序或按输入参数<code>args</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">log</span>(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>)<br><span class="hljs-comment">#&gt; [1] 3</span><br></code></pre></td></tr></table></figure>

<p>如果使用参数的名称，那么可以按照想要的顺序赋值：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">log</span>(base = <span class="hljs-number">2</span>, x = <span class="hljs-number">8</span>)<br><span class="hljs-comment">#&gt; [1] 3</span><br></code></pre></td></tr></table></figure>

<p><strong>要指定参数，我们必须使用<code>=</code>，而不能使用<code>&lt;-</code>。</strong></p>
<h3 id="四、预建对象"><a href="#四、预建对象" class="headerlink" title="四、预建对象"></a>四、预建对象</h3><p>查看所有可用的数据集：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">data()<br></code></pre></td></tr></table></figure>

<p>这将显示这些数据集的对象名称。这些数据集是可以通过简单地键入名称来使用的对象。例如，如果您键入：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">co2<br></code></pre></td></tr></table></figure>

<p>R将为您显示Mauna Loa的大气CO2浓度数据。</p>
<p>其他预建对象是数学量，例如常量和：π ∞</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">pi</span><br><span class="hljs-comment">#&gt; [1] 3.14</span><br><span class="hljs-literal">Inf</span>+<span class="hljs-number">1</span><br><span class="hljs-comment">#&gt; [1] Inf</span><br></code></pre></td></tr></table></figure>

<h2 id="II-数据类型"><a href="#II-数据类型" class="headerlink" title="II 数据类型"></a>II 数据类型</h2><p>R中的变量可以具有不同的类型。</p>
<p>函数<code>class</code>可帮助我们确定所拥有的对象类型：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">a &lt;- 2<br><span class="hljs-built_in">class</span>(a)<br><span class="hljs-comment">#&gt; [1] &quot;numeric&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="一、数据帧"><a href="#一、数据帧" class="headerlink" title="一、数据帧"></a>一、数据帧</h3><p>在R中存储数据集的最常见方法是在数据帧中。从概念上讲，我们可以将数据帧视为一个表，其中的行表示观察值，而每个观察值所报告的不同变量定义了列。</p>
<p>数据帧可以将不同的数据类型组合为一个对象。</p>
<p>eg：加载<strong>dslabs</strong>库并使用<code>data</code>功能加载数据集<code>murders</code>来访问此数据集：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">library(dslabs)<br>data(murders)<br></code></pre></td></tr></table></figure>

<p>实际上是一个数据帧，输入：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(murders)<br><span class="hljs-comment">#&gt; [1] &quot;data.frame&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="二、检查对象"><a href="#二、检查对象" class="headerlink" title="二、检查对象"></a>二、检查对象</h3><p>函数<code>str</code>：查找有关对象结构的更多信息：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">str(murders)<br><span class="hljs-comment">#&gt; &#x27;data.frame&#x27;:    51 obs. of  5 variables:</span><br><span class="hljs-comment">#&gt; $ state : chr &quot;Alabama&quot; &quot;Alaska&quot; &quot;Arizona&quot; &quot;Arkansas&quot; ...</span><br><span class="hljs-comment">#&gt; $ abb : chr &quot;AL&quot; &quot;AK&quot; &quot;AZ&quot; &quot;AR&quot; ...</span><br><span class="hljs-comment">#&gt; $ region : Factor w/ 4 levels &quot;Northeast&quot;,&quot;South&quot;,..: 2 4 4 2 4 4 1 2 2</span><br><span class="hljs-comment">#&gt;    2 ...</span><br><span class="hljs-comment">#&gt; $ population: num 4779736 710231 6392017 2915918 37253956 ...</span><br><span class="hljs-comment">#&gt; $ total : num 135 19 232 93 1257 ...</span><br></code></pre></td></tr></table></figure>

<p>这告诉我们有关该对象的更多信息。我们看到该表具有51行（50个状态加DC）和五个变量。我们可以使用函数<code>head</code>显示前六行：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">head(murders)<br><span class="hljs-comment">#&gt;        state abb region population total</span><br><span class="hljs-comment">#&gt; 1    Alabama  AL  South    4779736   135</span><br><span class="hljs-comment">#&gt; 2     Alaska  AK   West     710231    19</span><br><span class="hljs-comment">#&gt; 3    Arizona  AZ   West    6392017   232</span><br><span class="hljs-comment">#&gt; 4   Arkansas  AR  South    2915918    93</span><br><span class="hljs-comment">#&gt; 5 California  CA   West   37253956  1257</span><br><span class="hljs-comment">#&gt; 6   Colorado  CO   West    5029196    65</span><br></code></pre></td></tr></table></figure>

<p>在此数据集中，每个状态都被视为观察值，并且为每个状态报告了五个变量。</p>
<h3 id="三、访问器："><a href="#三、访问器：" class="headerlink" title="三、访问器：$"></a>三、访问器：<code>$</code></h3><p><code>$</code>访问此数据帧中包含的列所代表的不同变量：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs R">murders$population<br><span class="hljs-comment">#&gt;  [1]  4779736   710231  6392017  2915918 37253956  5029196  3574097</span><br><span class="hljs-comment">#&gt;  [8]   897934   601723 19687653  9920000  1360301  1567582 12830632</span><br><span class="hljs-comment">#&gt; [15]  6483802  3046355  2853118  4339367  4533372  1328361  5773552</span><br><span class="hljs-comment">#&gt; [22]  6547629  9883640  5303925  2967297  5988927   989415  1826341</span><br><span class="hljs-comment">#&gt; [29]  2700551  1316470  8791894  2059179 19378102  9535483   672591</span><br><span class="hljs-comment">#&gt; [36] 11536504  3751351  3831074 12702379  1052567  4625364   814180</span><br><span class="hljs-comment">#&gt; [43]  6346105 25145561  2763885   625741  8001024  6724540  1852994</span><br><span class="hljs-comment">#&gt; [50]  5686986   563626</span><br></code></pre></td></tr></table></figure>

<p><code>murders$population</code>的顺序保留了数据表中行的顺序。</p>
<h3 id="四、向量：数字，字符和逻辑"><a href="#四、向量：数字，字符和逻辑" class="headerlink" title="四、向量：数字，字符和逻辑"></a>四、向量：数字，字符和逻辑</h3><p>对象<code>murders$population</code>不是一个数字而是多个。我们称这些类型的对象为<em>向量</em>。</p>
<p>一个数字是一个长度为1的向量，但通常我们使用术语“向量”来指代具有多个条目的对象。函数<code>length</code>告诉您向量中有多少个条目：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">pop &lt;- murders$population<br><span class="hljs-built_in">length</span>(pop)<br><span class="hljs-comment">#&gt; [1] 51</span><br></code></pre></td></tr></table></figure>

<p>该特定向量是<em>数字，</em>因为总体大小是数字：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(pop)<br><span class="hljs-comment">#&gt; [1] &quot;numeric&quot;</span><br></code></pre></td></tr></table></figure>

<p>在数字向量中，每个条目都必须是一个数字。</p>
<p>为了存储字符串，向量也可以是<em>character</em>类。例如，状态名称是字符：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(murders$state)<br><span class="hljs-comment">#&gt; [1] &quot;character&quot;</span><br></code></pre></td></tr></table></figure>

<p>与数字向量一样，字符向量中的所有条目都必须是字符。</p>
<p>向量的另一种重要类型是<em>逻辑向量</em>。这些必须是<code>TRUE</code>或<code>FALSE</code>。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">z &lt;- 3 == <span class="hljs-number">2</span><br>z<br><span class="hljs-comment">#&gt; [1] FALSE</span><br><span class="hljs-built_in">class</span>(z)<br><span class="hljs-comment">#&gt; [1] &quot;logical&quot;</span><br></code></pre></td></tr></table></figure>

<p>这里<code>==</code>是一个关系运算符，询问3是否等于2。在R中，如果只使用一个<code>=</code>，则实际上分配了一个变量，但是如果使用两个<code>==</code>，则测试是否相等。</p>
<p>可以通过键入以下内容查看其他<em>关系运算符</em>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">?Comparison<br></code></pre></td></tr></table></figure>

<p>默认情况下，即使数字是舍入整数，数字也会被分配为类数字。</p>
<p>eg：<code>class(1)</code>返回数字，可以使用<code>as.integer()</code>函数或通过添加<code>L</code>如下代码将它们变成类整数<code>1L</code>。</p>
<p><code>class(1L)</code></p>
<h3 id="五、因素"><a href="#五、因素" class="headerlink" title="五、因素"></a>五、因素</h3><p>在<code>murders</code>数据集中：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(murders$region)<br><span class="hljs-comment">#&gt; [1] &quot;factor&quot;</span><br></code></pre></td></tr></table></figure>

<p>这是一个<em>因素</em>。因素对于存储分类数据很有用。通过使用<code>levels</code>函数可以看到只有四个区域：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">levels(murders$region)<br><span class="hljs-comment">#&gt; [1] &quot;Northeast&quot;     &quot;South&quot;         &quot;North Central&quot; &quot;West&quot;</span><br></code></pre></td></tr></table></figure>

<p>在后台，R将这些<em>级别</em>存储为整数，并保留一个映射以跟踪标签。这比存储所有字符更节省内存。</p>
<p>如果每个级别都有关联的值，我们可以使用<code>reorder</code>和指定一个数据摘要来确定顺序。以下代码将每个地区的谋杀总数加起来，并对这些总数后面的因子进行重新排序。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">region &lt;- murders$region<br>value &lt;- murders$total<br>region &lt;- reorder(region, value, FUN = <span class="hljs-built_in">sum</span>)<br>levels(region)<br><span class="hljs-comment">#&gt; [1] &quot;Northeast&quot;     &quot;North Central&quot; &quot;West&quot;          &quot;South&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="六、列表"><a href="#六、列表" class="headerlink" title="六、列表"></a>六、列表</h3><p>数据帧是<em>列表</em>的特例。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs R">record<br><span class="hljs-comment">#&gt; $name</span><br><span class="hljs-comment">#&gt; [1] &quot;John Doe&quot;</span><br><span class="hljs-comment">#&gt; </span><br><span class="hljs-comment">#&gt; $student_id</span><br><span class="hljs-comment">#&gt; [1] 1234</span><br><span class="hljs-comment">#&gt; </span><br><span class="hljs-comment">#&gt; $grades</span><br><span class="hljs-comment">#&gt; [1] 95 82 91 97 93</span><br><span class="hljs-comment">#&gt; </span><br><span class="hljs-comment">#&gt; $final_grade</span><br><span class="hljs-comment">#&gt; [1] &quot;A&quot;</span><br><span class="hljs-built_in">class</span>(record)<br><span class="hljs-comment">#&gt; [1] &quot;list&quot;</span><br></code></pre></td></tr></table></figure>

<p>与数据帧一样，可以使用<code>$</code>提取列表的组成部分。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">record$student_id<br><span class="hljs-comment">#&gt; [1] 1234</span><br></code></pre></td></tr></table></figure>

<p>我们也可以<code>[[</code>像这样使用双方括号：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">record[[<span class="hljs-string">&quot;student_id&quot;</span>]]<br><span class="hljs-comment">#&gt; [1] 1234</span><br></code></pre></td></tr></table></figure>

<p>在R中，通常有几种方法可以执行相同的操作。</p>
<p>没有变量名的列表：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">record2<br><span class="hljs-comment">#&gt; [[1]]</span><br><span class="hljs-comment">#&gt; [1] &quot;John Doe&quot;</span><br><span class="hljs-comment">#&gt; </span><br><span class="hljs-comment">#&gt; [[2]]</span><br><span class="hljs-comment">#&gt; [1] 1234</span><br></code></pre></td></tr></table></figure>

<p><strong>如果列表中没有名称，则不能使用来提取元素<code>$</code>，但仍可以使用方括号方法，并且可以提供列表索引，而不是提供变量名称</strong>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">record2[[<span class="hljs-number">1</span>]]<br><span class="hljs-comment">#&gt; [1] &quot;John Doe&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="七、矩阵"><a href="#七、矩阵" class="headerlink" title="七、矩阵"></a>七、矩阵</h3><p>矩阵是R中常见的另一种对象。矩阵与数据帧类似，因为它们是二维的：它们具有行和列。但是，像数字，字符和逻辑向量一样，矩阵中的条目必须全部为同一类型。</p>
<p>与数据帧相比，矩阵具有主要优势是可以执行矩阵代数运算。</p>
<p>使用<code>matrix</code>函数定义一个矩阵，指定行数和列数。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">mat &lt;- matrix(<span class="hljs-number">1</span>:<span class="hljs-number">12</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>)<br>mat<br><span class="hljs-comment">#&gt;      [,1] [,2] [,3]</span><br><span class="hljs-comment">#&gt; [1,]    1    5    9</span><br><span class="hljs-comment">#&gt; [2,]    2    6   10</span><br><span class="hljs-comment">#&gt; [3,]    3    7   11</span><br><span class="hljs-comment">#&gt; [4,]    4    8   12</span><br></code></pre></td></tr></table></figure>

<p>可以使用方括号<code>[</code>访问矩阵中的特定条目。如果要第二行第三列，使用：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">mat[<span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<br><span class="hljs-comment">#&gt; [1] 10</span><br></code></pre></td></tr></table></figure>

<p>如果要整个第二行，则将列位置保留为空：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">mat[<span class="hljs-number">2</span>, ]<br><span class="hljs-comment">#&gt; [1]  2  6 10</span><br></code></pre></td></tr></table></figure>

<p>如果要整个第三列，行位置保留为空白：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">mat[, <span class="hljs-number">3</span>]<br><span class="hljs-comment">#&gt; [1]  9 10 11 12</span><br></code></pre></td></tr></table></figure>

<p>这也是一个向量，而不是矩阵。</p>
<p>访问多于一列或多于一行，返回一个新的矩阵。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">mat[, <span class="hljs-number">2</span>:<span class="hljs-number">3</span>]<br><span class="hljs-comment">#&gt;      [,1] [,2]</span><br><span class="hljs-comment">#&gt; [1,]    5    9</span><br><span class="hljs-comment">#&gt; [2,]    6   10</span><br><span class="hljs-comment">#&gt; [3,]    7   11</span><br><span class="hljs-comment">#&gt; [4,]    8   12</span><br></code></pre></td></tr></table></figure>

<p>将行和列都作为子集：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">mat[<span class="hljs-number">1</span>:<span class="hljs-number">2</span>, <span class="hljs-number">2</span>:<span class="hljs-number">3</span>]<br><span class="hljs-comment">#&gt;      [,1] [,2]</span><br><span class="hljs-comment">#&gt; [1,]    5    9</span><br><span class="hljs-comment">#&gt; [2,]    6   10</span><br></code></pre></td></tr></table></figure>

<p>可以使用函数将矩阵转换为数据帧<code>as.data.frame</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">as.data.frame(mat)<br><span class="hljs-comment">#&gt;   V1 V2 V3</span><br><span class="hljs-comment">#&gt; 1  1  5  9</span><br><span class="hljs-comment">#&gt; 2  2  6 10</span><br><span class="hljs-comment">#&gt; 3  3  7 11</span><br><span class="hljs-comment">#&gt; 4  4  8 12</span><br></code></pre></td></tr></table></figure>

<p>可以使用单个方括号<code>[</code>访问数据帧的行和列：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">data(<span class="hljs-string">&quot;murders&quot;</span>)<br>murders[<span class="hljs-number">25</span>, <span class="hljs-number">1</span>]<br><span class="hljs-comment">#&gt; [1] &quot;Mississippi&quot;</span><br>murders[<span class="hljs-number">2</span>:<span class="hljs-number">3</span>, ]<br><span class="hljs-comment">#&gt;     state abb region population total</span><br><span class="hljs-comment">#&gt; 2  Alaska  AK   West     710231    19</span><br><span class="hljs-comment">#&gt; 3 Arizona  AZ   West    6392017   232</span><br></code></pre></td></tr></table></figure>

<h2 id="III-向量与强制"><a href="#III-向量与强制" class="headerlink" title="III 向量与强制"></a>III 向量与强制</h2><p>R中，可用于存储数据的最基本对象是<em>vector</em>。可以将复杂的数据集分解为向量的组成部分。例如，在数据帧中，每一列都是一个向量。</p>
<h3 id="一、创建向量"><a href="#一、创建向量" class="headerlink" title="一、创建向量"></a>一、创建向量</h3><p>我们可以使用<code>c</code>表示<em>串联</em>的函数创建向量。我们使用<code>c</code>以下方式连接条目：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">codes &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">380</span>, <span class="hljs-number">124</span>, <span class="hljs-number">818</span>)<br>codes<br><span class="hljs-comment">#&gt; [1] 380 124 818</span><br></code></pre></td></tr></table></figure>

<p>我们还可以创建字符向量。我们使用引号表示条目是字符而不是变量名。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">country &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;italy&quot;</span>, <span class="hljs-string">&quot;canada&quot;</span>, <span class="hljs-string">&quot;egypt&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>在R中，也可以使用单引号：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">country &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-string">&#x27;italy&#x27;</span>, <span class="hljs-string">&#x27;canada&#x27;</span>, <span class="hljs-string">&#x27;egypt&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>但是请注意不要将单引号’与<em>反引号</em> ` 混淆。</p>
<p>如果键入：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">country &lt;- <span class="hljs-built_in">c</span>(italy, canada, egypt)<br></code></pre></td></tr></table></figure>

<p>会收到一个错误，因为变量<code>italy</code>，<code>canada</code>以及<code>egypt</code>没有定义。如果我们不使用引号，则R查找具有这些名称的变量并返回错误。</p>
<h3 id="二、名称"><a href="#二、名称" class="headerlink" title="二、名称"></a>二、名称</h3><p>有时，命名向量的条目很有用。例如，在定义国家/地区代码的向量时，我们可以使用名称将两者联系起来：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">codes &lt;- <span class="hljs-built_in">c</span>(italy = <span class="hljs-number">380</span>, canada = <span class="hljs-number">124</span>, egypt = <span class="hljs-number">818</span>)<br>codes<br><span class="hljs-comment">#&gt;  italy canada  egypt </span><br><span class="hljs-comment">#&gt;    380    124    818</span><br></code></pre></td></tr></table></figure>

<p>该对象<code>codes</code>仍然是数字矢量：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(codes)<br><span class="hljs-comment">#&gt; [1] &quot;numeric&quot;</span><br></code></pre></td></tr></table></figure>

<p>但名称：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">names</span>(codes)<br><span class="hljs-comment">#&gt; [1] &quot;italy&quot;  &quot;canada&quot; &quot;egypt&quot;</span><br></code></pre></td></tr></table></figure>

<p>可以使用引号：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">codes &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;italy&quot;</span> = <span class="hljs-number">380</span>, <span class="hljs-string">&quot;canada&quot;</span> = <span class="hljs-number">124</span>, <span class="hljs-string">&quot;egypt&quot;</span> = <span class="hljs-number">818</span>)<br>codes<br><span class="hljs-comment">#&gt;  italy canada  egypt </span><br><span class="hljs-comment">#&gt;    380    124    818</span><br></code></pre></td></tr></table></figure>

<p>此函数调用与上一个函数没有区别。与其他语言相比，R是古怪的多种方式之一。</p>
<p>我们还可以使用以下<code>names</code>功能分配名称：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">codes &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">380</span>, <span class="hljs-number">124</span>, <span class="hljs-number">818</span>)<br>country &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;italy&quot;</span>,<span class="hljs-string">&quot;canada&quot;</span>,<span class="hljs-string">&quot;egypt&quot;</span>)<br><span class="hljs-built_in">names</span>(codes) &lt;- country<br>codes<br><span class="hljs-comment">#&gt;  italy canada  egypt </span><br><span class="hljs-comment">#&gt;    380    124    818</span><br></code></pre></td></tr></table></figure>

<h3 id="三、序列"><a href="#三、序列" class="headerlink" title="三、序列"></a>三、序列</h3><p>创建向量的另一个有用功能是生成序列：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">seq(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<br><span class="hljs-comment">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span><br></code></pre></td></tr></table></figure>

<p>第一个参数定义开始，第二个参数定义结束。默认值以1为增量增加，但是第三个参数让我们告诉它要跳过多少：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">seq(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>)<br><span class="hljs-comment">#&gt; [1] 1 3 5 7 9</span><br></code></pre></td></tr></table></figure>

<p>如果我们需要连续的整数，则可以使用以下速记：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">1:<span class="hljs-number">10</span><br><span class="hljs-comment">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span><br></code></pre></td></tr></table></figure>

<p>当我们使用这些函数时，R生成整数而不是数字，因为它们通常用于索引某些内容：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(<span class="hljs-number">1</span>:<span class="hljs-number">10</span>)<br><span class="hljs-comment">#&gt; [1] &quot;integer&quot;</span><br></code></pre></td></tr></table></figure>

<p>但是，如果我们创建一个包含非整数的序列，则该类将更改：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(seq(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">0.5</span>))<br><span class="hljs-comment">#&gt; [1] &quot;numeric&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="四、子集"><a href="#四、子集" class="headerlink" title="四、子集"></a>四、子集</h3><p>我们使用方括号来访问向量的特定元素。对于<code>codes</code>我们上面定义的向量，我们可以使用以下方法访问第二个元素：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">codes[<span class="hljs-number">2</span>]<br><span class="hljs-comment">#&gt; canada </span><br><span class="hljs-comment">#&gt;    124</span><br></code></pre></td></tr></table></figure>

<p>通过使用多条目向量作为索引，可以获得多个条目：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">codes[<span class="hljs-built_in">c</span>(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>)]<br><span class="hljs-comment">#&gt; italy egypt </span><br><span class="hljs-comment">#&gt;   380   818</span><br></code></pre></td></tr></table></figure>

<p>如果我们要访问例如前两个元素，则上面定义的序列特别有用：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">codes[<span class="hljs-number">1</span>:<span class="hljs-number">2</span>]<br><span class="hljs-comment">#&gt;  italy canada </span><br><span class="hljs-comment">#&gt;    380    124</span><br></code></pre></td></tr></table></figure>

<p>如果元素具有名称，我们也可以使用这些名称访问条目。以下是两个示例。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">codes[<span class="hljs-string">&quot;canada&quot;</span>]<br><span class="hljs-comment">#&gt; canada </span><br><span class="hljs-comment">#&gt;    124</span><br>codes[<span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;egypt&quot;</span>,<span class="hljs-string">&quot;italy&quot;</span>)]<br><span class="hljs-comment">#&gt; egypt italy </span><br><span class="hljs-comment">#&gt;   818   380</span><br></code></pre></td></tr></table></figure>

<h3 id="五、强制"><a href="#五、强制" class="headerlink" title="五、强制"></a>五、强制</h3><p>通常，<em>强制</em>是R尝试灵活处理数据类型。</p>
<p>当某个条目与预期的不匹配时，一些预构建的R函数会在抛出错误之前尝试猜测其含义。这也可能导致混乱。</p>
<p>eg:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">x &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;canada&quot;</span>, <span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure>

<p>但是我们没有得到警告，看一下<code>x</code>的类：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">x<br>#&gt; [1] &quot;1&quot;      &quot;canada&quot; &quot;3&quot;<br>class(x)<br>#&gt; [1] &quot;character&quot;<br></code></pre></td></tr></table></figure>

<p>R 将数据<em>强制</em>转换为字符。它猜测是因为在向量中放入了一个字符串，所以实际上将1和3当作字符串<code>&quot;1&quot;</code>和“ <code>3</code>”。</p>
<p>R还提供了从一种类型更改为另一种类型的功能。例如，可以使用以下方法将数字转换为字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">x &lt;- 1:5<br>y &lt;- as.character(x)<br>y<br>#&gt; [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot;<br></code></pre></td></tr></table></figure>

<p>可以使用<code>as.numeric</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">as.numeric(y)<br>#&gt; [1] 1 2 3 4 5<br></code></pre></td></tr></table></figure>

<p>该功能实际上非常有用，因为包含数字作为字符串的数据集是常见的。</p>
<p>当函数试图将一种类型强制转换为另一种类型并遇到不可能的情况时，它通常会向我们发出警告，并将该条目转换为一个特殊值，称为<code>NA</code>“不可用”。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">x &lt;- c(&quot;1&quot;, &quot;b&quot;, &quot;3&quot;)<br>as.numeric(x)<br>#&gt; Warning: NAs introduced by coercion<br>#&gt; [1]  1 NA  3<br></code></pre></td></tr></table></figure>

<p>当输入时<code>b</code>，R不会对想要的数字有任何猜测，因此不会尝试。</p>
<p>经常会遇到<code>NA</code>，因为它们通常用于丢失数据，这是现实数据集中的常见问题。</p>
<h2 id="IV-排序"><a href="#IV-排序" class="headerlink" title="IV 排序"></a>IV 排序</h2><h3 id="一、-sort"><a href="#一、-sort" class="headerlink" title="一、 sort"></a>一、 <code>sort</code></h3><p>函数<code>sort</code>按升序对向量进行排序。因此，通过键入以下内容，可以看到最多的枪杀案：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">library(dslabs)<br>data(murders)<br>sort(murders$total)<br><span class="hljs-comment">#&gt;  [1]    2    4    5    5    7    8   11   12   12   16   19   21   22</span><br><span class="hljs-comment">#&gt; [14]   27   32   36   38   53   63   65   67   84   93   93   97   97</span><br><span class="hljs-comment">#&gt; [27]   99  111  116  118  120  135  142  207  219  232  246  250  286</span><br><span class="hljs-comment">#&gt; [40]  293  310  321  351  364  376  413  457  517  669  805 1257</span><br></code></pre></td></tr></table></figure>

<p>但是，这并不能为我们提供有关哪个州共有哪些谋杀案的信息。例如，我们不知道哪个州拥有1257。</p>
<h3 id="二、order"><a href="#二、order" class="headerlink" title="二、order"></a>二、<code>order</code></h3><p>功能<code>order</code>更接近我们想要的。它以向量为输入，并返回对输入向量进行排序的索引向量。这听起来可能令人困惑，所以让我们看一个简单的例子。我们可以创建一个向量并将其排序：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">x &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">31</span>, <span class="hljs-number">4</span>, <span class="hljs-number">15</span>, <span class="hljs-number">92</span>, <span class="hljs-number">65</span>)<br>sort(x)<br><span class="hljs-comment">#&gt; [1]  4 15 31 65 92</span><br></code></pre></td></tr></table></figure>

<p>该函数<code>order</code>返回对输入向量进行排序的索引，而不是对输入向量进行排序：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">index &lt;- order(x)<br>x[index]<br><span class="hljs-comment">#&gt; [1]  4 15 31 65 92</span><br></code></pre></td></tr></table></figure>

<p>这与所返回的输出相同<code>sort(x)</code>。如果我们看一下这个索引，就会明白它为什么起作用：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">x<br><span class="hljs-comment">#&gt; [1] 31  4 15 92 65</span><br>order(x)<br><span class="hljs-comment">#&gt; [1] 2 3 1 5 4</span><br></code></pre></td></tr></table></figure>

<p>这如何帮助我们通过谋杀来命令各州？首先，请记住，您访问的向量的条目与<code>$</code>表中的行遵循相同的顺序。例如，这两个分别包含状态名称和缩写的向量按其顺序匹配：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">murders$state[<span class="hljs-number">1</span>:<span class="hljs-number">6</span>]<br><span class="hljs-comment">#&gt; [1] &quot;Alabama&quot;    &quot;Alaska&quot;     &quot;Arizona&quot;    &quot;Arkansas&quot;   &quot;California&quot;</span><br><span class="hljs-comment">#&gt; [6] &quot;Colorado&quot;</span><br>murders$abb[<span class="hljs-number">1</span>:<span class="hljs-number">6</span>]<br><span class="hljs-comment">#&gt; [1] &quot;AL&quot; &quot;AK&quot; &quot;AZ&quot; &quot;AR&quot; &quot;CA&quot; &quot;CO&quot;</span><br></code></pre></td></tr></table></figure>

<p>这意味着我们可以根据他们的谋杀总数来对州名进行排序。我们首先获得根据谋杀总数对向量进行排序的索引，然后对状态名称向量进行索引：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">ind &lt;- order(murders$total) <br>murders$abb[ind] <br><span class="hljs-comment">#&gt;  [1] &quot;VT&quot; &quot;ND&quot; &quot;NH&quot; &quot;WY&quot; &quot;HI&quot; &quot;SD&quot; &quot;ME&quot; &quot;ID&quot; &quot;MT&quot; &quot;RI&quot; &quot;AK&quot; &quot;IA&quot; &quot;UT&quot;</span><br><span class="hljs-comment">#&gt; [14] &quot;WV&quot; &quot;NE&quot; &quot;OR&quot; &quot;DE&quot; &quot;MN&quot; &quot;KS&quot; &quot;CO&quot; &quot;NM&quot; &quot;NV&quot; &quot;AR&quot; &quot;WA&quot; &quot;CT&quot; &quot;WI&quot;</span><br><span class="hljs-comment">#&gt; [27] &quot;DC&quot; &quot;OK&quot; &quot;KY&quot; &quot;MA&quot; &quot;MS&quot; &quot;AL&quot; &quot;IN&quot; &quot;SC&quot; &quot;TN&quot; &quot;AZ&quot; &quot;NJ&quot; &quot;VA&quot; &quot;NC&quot;</span><br><span class="hljs-comment">#&gt; [40] &quot;MD&quot; &quot;OH&quot; &quot;MO&quot; &quot;LA&quot; &quot;IL&quot; &quot;GA&quot; &quot;MI&quot; &quot;PA&quot; &quot;NY&quot; &quot;FL&quot; &quot;TX&quot; &quot;CA&quot;</span><br></code></pre></td></tr></table></figure>

<p>根据以上所述，加州谋杀案最多。</p>
<h3 id="三、-max和which-max"><a href="#三、-max和which-max" class="headerlink" title="三、 max和which.max"></a>三、 <code>max</code>和<code>which.max</code></h3><p>如果我们只对值最大的条目感兴趣，则可以使用<code>max</code>该值：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">max</span>(murders$total)<br><span class="hljs-comment">#&gt; [1] 1257</span><br></code></pre></td></tr></table></figure>

<p>而<code>which.max</code>对于最大价值的指标：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">i_max &lt;- which.max(murders$total)<br>murders$state[i_max]<br><span class="hljs-comment">#&gt; [1] &quot;California&quot;</span><br></code></pre></td></tr></table></figure>

<p>可以以相同的方式使用<code>min</code>和<code>which.min</code>。</p>
<h3 id="四、rank"><a href="#四、rank" class="headerlink" title="四、rank"></a>四、<code>rank</code></h3><p><code>rank</code>与顺序有关，对于任何给定的向量，它返回一个具有输入向量的第一项，第二项等的排序的向量。</p>
<p>eg:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">x &lt;- c(31, 4, 15, 92, 65)<br>rank(x)<br>#&gt; [1] 3 1 2 5 4<br></code></pre></td></tr></table></figure>

<h3 id="五、回收"><a href="#五、回收" class="headerlink" title="五、回收"></a>五、回收</h3><p>R中未注意到的错误的另一个常见来源是<em>回收</em>的使用。向量是逐元素相加的。因此，如果向量的长度不匹配，应该得到一个错误。但是我们没有。注意发生了什么：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">x &lt;- c(1,2,3)<br>y &lt;- c(10, 20, 30, 40, 50, 60, 70)<br>x+y<br>#&gt; Warning in x + y: longer object length is not a multiple of shorter<br>#&gt; object length<br>#&gt; [1] 11 22 33 41 52 63 71<br></code></pre></td></tr></table></figure>

<p>我们确实收到警告，但没有错误。对于输出，R回收了中的数字<code>x</code>。注意输出中数字的最后一位。</p>
<h2 id="V-数学运算"><a href="#V-数学运算" class="headerlink" title="V 数学运算"></a>V 数学运算</h2><h3 id="一、重新缩放向量"><a href="#一、重新缩放向量" class="headerlink" title="一、重新缩放向量"></a>一、重新缩放向量</h3><p>在R中，对向量的算术运算按<em>元素进行</em>。举个简单的例子，假设我们的高度以英寸为单位：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">inches &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">69</span>, <span class="hljs-number">62</span>, <span class="hljs-number">66</span>, <span class="hljs-number">70</span>, <span class="hljs-number">70</span>, <span class="hljs-number">73</span>, <span class="hljs-number">67</span>, <span class="hljs-number">73</span>, <span class="hljs-number">67</span>, <span class="hljs-number">70</span>)<br></code></pre></td></tr></table></figure>

<p>转换为厘米，即<code>inches</code>乘以2.54：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">inches * <span class="hljs-number">2.54</span><br><span class="hljs-comment">#&gt;  [1] 175 157 168 178 178 185 170 185 170 178</span><br></code></pre></td></tr></table></figure>

<p>为每个条目计算男性的平均身高高出或短于69英寸的长度，则可以从每个条目中减去它：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">inches - <span class="hljs-number">69</span><br><span class="hljs-comment">#&gt;  [1]  0 -7 -3  1  1  4 -2  4 -2  1</span><br></code></pre></td></tr></table></figure>

<h3 id="二、双向量运算"><a href="#二、双向量运算" class="headerlink" title="二、双向量运算"></a>二、双向量运算</h3><p>如果我们有两个长度相同的向量，并在R中将它们求和，则将它们逐项相加，如下所示：</p>
<p>这意味着要计算谋杀率，我们可以简单地输入：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">murder_rate &lt;- murders$total / murders$population * <span class="hljs-number">100000</span><br></code></pre></td></tr></table></figure>

<p>完成此操作后，我们会注意到加利福尼亚不再位于列表的顶部。实际上，我们可以利用我们所学的知识以谋杀率对各州进行排序：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">murders$abb[order(murder_rate)]<br><span class="hljs-comment">#&gt;  [1] &quot;VT&quot; &quot;NH&quot; &quot;HI&quot; &quot;ND&quot; &quot;IA&quot; &quot;ID&quot; &quot;UT&quot; &quot;ME&quot; &quot;WY&quot; &quot;OR&quot; &quot;SD&quot; &quot;MN&quot; &quot;MT&quot;</span><br><span class="hljs-comment">#&gt; [14] &quot;CO&quot; &quot;WA&quot; &quot;WV&quot; &quot;RI&quot; &quot;WI&quot; &quot;NE&quot; &quot;MA&quot; &quot;IN&quot; &quot;KS&quot; &quot;NY&quot; &quot;KY&quot; &quot;AK&quot; &quot;OH&quot;</span><br><span class="hljs-comment">#&gt; [27] &quot;CT&quot; &quot;NJ&quot; &quot;AL&quot; &quot;IL&quot; &quot;OK&quot; &quot;NC&quot; &quot;NV&quot; &quot;VA&quot; &quot;AR&quot; &quot;TX&quot; &quot;NM&quot; &quot;CA&quot; &quot;FL&quot;</span><br><span class="hljs-comment">#&gt; [40] &quot;TN&quot; &quot;PA&quot; &quot;AZ&quot; &quot;GA&quot; &quot;MS&quot; &quot;MI&quot; &quot;DE&quot; &quot;SC&quot; &quot;MD&quot; &quot;MO&quot; &quot;LA&quot; &quot;DC&quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="VI-索引"><a href="#VI-索引" class="headerlink" title="VI 索引"></a><p align="center">VI 索引</p><p></p></h2><p>R提供了一种强大而便捷的索引向量的方式。例如，我们可以根据另一个向量的属性对向量进行子集化，即加载：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">library(dslabs)<br>data(<span class="hljs-string">&quot;murders&quot;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="一、用逻辑子集"><a href="#一、用逻辑子集" class="headerlink" title="一、用逻辑子集"></a>一、用逻辑子集</h3><p>使用以下方法计算谋杀率：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">murder_rate &lt;- murders$total / murders$population * <span class="hljs-number">100000</span> <br></code></pre></td></tr></table></figure>

<p>eg:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">ind &lt;- murder_rate &lt; <span class="hljs-number">0.71</span><br></code></pre></td></tr></table></figure>

<p>如果想知道某个值是小于还是等于，则可以使用：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">ind &lt;- murder_rate &lt;= <span class="hljs-number">0.71</span><br></code></pre></td></tr></table></figure>

<p><code>TRUE</code>对于每个条目返回的逻辑向量均小于或等于0.71。为了查看这些状态，可以用逻辑索引。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">murders$state[ind]<br><span class="hljs-comment">#&gt; [1] &quot;Hawaii&quot;        &quot;Iowa&quot;          &quot;New Hampshire&quot; &quot;North Dakota&quot; </span><br><span class="hljs-comment">#&gt; [5] &quot;Vermont&quot;</span><br></code></pre></td></tr></table></figure>

<p>为了计算有多少是TRUE，函数<code>sum</code>返回向量的项之和，逻辑向量被<em>强制转换</em>为数字，<code>TRUE</code>并被编码为1和<code>FALSE</code>0。对状态进行计数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">sum</span>(ind)<br><span class="hljs-comment">#&gt; [1] 5</span><br></code></pre></td></tr></table></figure>

<h3 id="二、逻辑运算符"><a href="#二、逻辑运算符" class="headerlink" title="二、逻辑运算符"></a>二、逻辑运算符</h3><p>假设我们喜欢高山，并且想要迁移到该国安全的西部地区。我们希望谋杀率最高为1。在这种情况下，有两种不同的说法是正确的，可以使用逻辑运算符<em>and</em>，它在R中用表示<code>&amp;</code>。<code>TRUE</code>仅当两个逻辑均为时，此操作才会产生<code>TRUE</code>。</p>
<p>eg:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-literal">TRUE</span> &amp; <span class="hljs-literal">TRUE</span><br><span class="hljs-comment">#&gt; [1] TRUE</span><br><span class="hljs-literal">TRUE</span> &amp; <span class="hljs-literal">FALSE</span><br><span class="hljs-comment">#&gt; [1] FALSE</span><br><span class="hljs-literal">FALSE</span> &amp; <span class="hljs-literal">FALSE</span><br><span class="hljs-comment">#&gt; [1] FALSE</span><br></code></pre></td></tr></table></figure>

<p>可以形成两种逻辑：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">west &lt;- murders$region == <span class="hljs-string">&quot;West&quot;</span><br>safe &lt;- murder_rate &lt;= <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>并且使用<code>&amp;</code>来获得逻辑向量，告诉我们哪些状态满足两个条件：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">ind &lt;- safe &amp; west<br>murders$state[ind]<br><span class="hljs-comment">#&gt; [1] &quot;Hawaii&quot;  &quot;Idaho&quot;   &quot;Oregon&quot;  &quot;Utah&quot;    &quot;Wyoming&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="三、-which"><a href="#三、-which" class="headerlink" title="三、 which"></a>三、 <code>which</code></h3><p>假设要查询加利福尼亚的谋杀率。对于这种类型的操作，将逻辑向量转换成索引很方便，而不是保留逻辑的长向量。函数<code>which</code>告诉我们逻辑向量的哪些条目为TRUE。所以可以输入：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">ind &lt;- which(murders$state == <span class="hljs-string">&quot;California&quot;</span>)<br>murder_rate[ind]<br><span class="hljs-comment">#&gt; [1] 3.37</span><br></code></pre></td></tr></table></figure>

<h3 id="四、match"><a href="#四、match" class="headerlink" title="四、match"></a>四、<code>match</code></h3><p>如果我们要找出纽约，佛罗里达州和德克萨斯州等多个州的谋杀率，而不仅仅是一个州，则可以使用该函数<code>match</code>。此函数告诉我们第二个向量的哪些索引与第一个向量的每个条目匹配：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">ind &lt;- match(<span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;New York&quot;</span>, <span class="hljs-string">&quot;Florida&quot;</span>, <span class="hljs-string">&quot;Texas&quot;</span>), murders$state)<br>ind<br><span class="hljs-comment">#&gt; [1] 33 10 44</span><br></code></pre></td></tr></table></figure>

<p>现在我们来看看谋杀率：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">murder_rate[ind]<br><span class="hljs-comment">#&gt; [1] 2.67 3.40 3.20</span><br></code></pre></td></tr></table></figure>

<h3 id="五-in"><a href="#五-in" class="headerlink" title="五 %in%"></a>五 <code>%in%</code></h3><p>如果我们想要一个逻辑而不是索引来告诉我们第一个向量的每个元素是否在第二个元素中，那么我们可以使用函数<code>%in%</code>。如果不确定波士顿，达科他州和华盛顿州是否为州，则可以这样查找：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;Boston&quot;</span>, <span class="hljs-string">&quot;Dakota&quot;</span>, <span class="hljs-string">&quot;Washington&quot;</span>) %in% murders$state<br><span class="hljs-comment">#&gt; [1] FALSE FALSE  TRUE</span><br></code></pre></td></tr></table></figure>

<h2 id="VII-基本语法"><a href="#VII-基本语法" class="headerlink" title="VII 基本语法"></a>VII 基本语法</h2><h3 id="一、条件表达式"><a href="#一、条件表达式" class="headerlink" title="一、条件表达式"></a>一、条件表达式</h3><p>条件表达式是编程的基本功能之一。</p>
<p>这是一个非常简单的示例，显示了if-else语句的一般结构。基本思想是打印除0以外<code>a</code>的倒数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">a &lt;- 0<br><br><span class="hljs-keyword">if</span>(a!=<span class="hljs-number">0</span>)&#123;<br>  print(<span class="hljs-number">1</span>/a)<br>&#125; <span class="hljs-keyword">else</span>&#123;<br>  print(<span class="hljs-string">&quot;No reciprocal for 0.&quot;</span>)<br>&#125;<br><span class="hljs-comment">#&gt; [1] &quot;No reciprocal for 0.&quot;</span><br></code></pre></td></tr></table></figure>

<p>让我们再看一个使用美国谋杀数据框架的示例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">library(dslabs)<br>data(murders)<br>murder_rate &lt;- murders$total / murders$population*<span class="hljs-number">100000</span><br></code></pre></td></tr></table></figure>

<p>这是一个非常简单的例子，告诉我们哪个州的谋杀率低于每十万分之0.5。该<code>if</code>语句排除了任何国家都不满足该条件的情况。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">ind &lt;- which.min(murder_rate)<br><br><span class="hljs-keyword">if</span>(murder_rate[ind] &lt; <span class="hljs-number">0.5</span>)&#123;<br>  print(murders$state[ind]) <br>&#125; <span class="hljs-keyword">else</span>&#123;<br>  print(<span class="hljs-string">&quot;No state has murder rate that low&quot;</span>)<br>&#125;<br><span class="hljs-comment">#&gt; [1] &quot;Vermont&quot;</span><br></code></pre></td></tr></table></figure>

<p>如果我们以0.25的速率再次尝试，则会得到不同的答案：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-keyword">if</span>(murder_rate[ind] &lt; <span class="hljs-number">0.25</span>)&#123;<br>  print(murders$state[ind]) <br>&#125; <span class="hljs-keyword">else</span>&#123;<br>  print(<span class="hljs-string">&quot;No state has a murder rate that low.&quot;</span>)<br>&#125;<br><span class="hljs-comment">#&gt; [1] &quot;No state has a murder rate that low.&quot;</span><br></code></pre></td></tr></table></figure>

<p>一个非常有用的相关功能是<code>ifelse</code>。此函数采用三个参数：逻辑和两个可能的答案。如果逻辑为<code>TRUE</code>，则返回第二个参数的值，如果为<code>FALSE</code>，则返回第三个参数的值。比如 ：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">a &lt;- 0<br>ifelse(a &gt; <span class="hljs-number">0</span>, <span class="hljs-number">1</span>/a, <span class="hljs-literal">NA</span>)<br><span class="hljs-comment">#&gt; [1] NA</span><br></code></pre></td></tr></table></figure>

<p>该函数适用于矢量，它检查逻辑向量的每个条目，如果条目为<code>TRUE</code>，则返回第二个自变量提供的向量中的元素，如果条目为<code>FALSE</code>，则返回第三个自变量提供的向量中的元素。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">a &lt;- <span class="hljs-built_in">c</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, -<span class="hljs-number">4</span>, <span class="hljs-number">5</span>)<br>result &lt;- ifelse(a &gt; <span class="hljs-number">0</span>, <span class="hljs-number">1</span>/a, <span class="hljs-literal">NA</span>)<br></code></pre></td></tr></table></figure>

<h3 id="二、定义函数"><a href="#二、定义函数" class="headerlink" title="二、定义函数"></a>二、定义函数</h3><p>函数不存在的情况，R允许编写自己的函数。比如定义一个简单的计算平均值的函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">avg &lt;- <span class="hljs-keyword">function</span>(x)&#123;<br>  s &lt;- <span class="hljs-built_in">sum</span>(x)<br>  n &lt;- <span class="hljs-built_in">length</span>(x)<br>  s/n<br>&#125;<br></code></pre></td></tr></table></figure>

<p>现在<code>avg</code>是一个计算均值的函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">x &lt;- 1:<span class="hljs-number">100</span><br>identical(mean(x), avg(x))<br><span class="hljs-comment">#&gt; [1] TRUE</span><br></code></pre></td></tr></table></figure>

<p>在函数内部定义的变量不会保存在工作空间中。因此，在使用<code>s</code>和<code>n</code>调用时<code>avg</code>，仅在调用期间创建和更改值。比如：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">s &lt;- 3<br>avg(<span class="hljs-number">1</span>:<span class="hljs-number">10</span>)<br><span class="hljs-comment">#&gt; [1] 5.5</span><br>s<br><span class="hljs-comment">#&gt; [1] 3</span><br></code></pre></td></tr></table></figure>

<p>通常，函数是对象，因此我们使用<code>&lt;-</code>给它们分配变量名。该函数<code>function</code>告诉R您将要定义一个函数。函数定义的一般形式如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">my_function &lt;- <span class="hljs-keyword">function</span>(VARIABLE_NAME)&#123;<br>  perform operations on VARIABLE_NAME and calculate VALUE<br>  VALUE<br>&#125;<br></code></pre></td></tr></table></figure>

<p>被定义的函数可以具有多个参数以及默认值。例如，我们可以定义一个函数，该函数根据用户定义的变量来计算算术平均值或几何平均值，如下所示：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">avg &lt;- <span class="hljs-keyword">function</span>(x, arithmetic = <span class="hljs-literal">TRUE</span>)&#123;<br>  n &lt;- <span class="hljs-built_in">length</span>(x)<br>  ifelse(arithmetic, <span class="hljs-built_in">sum</span>(x)/n, <span class="hljs-built_in">prod</span>(x)^(<span class="hljs-number">1</span>/n))<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="三、命名空间"><a href="#三、命名空间" class="headerlink" title="三、命名空间"></a>三、命名空间</h3><p>两个软件包可能对两个不同的函数使用相同的名称。通常，这些函数会做完全不同的事情。</p>
<p>eg：<strong>dplyr</strong>和R-base <strong>stats</strong>包都定义了一个<code>filter</code>函数。<strong>dplyr中</strong>还有其他五个例子。之所以知道这一点，是因为当我们第一次加载<strong>dplyr时</strong>，会看到以下消息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">The following objects are masked from ‘package:stats’:<br><br>    filter, lag<br><br>The following objects are masked from ‘package:base’:<br><br>    intersect, setdiff, setequal, union<br></code></pre></td></tr></table></figure>

<p>那么当我们键入时R会做什么<code>filter</code>？它使用<strong>dplyr</strong>函数还是<strong>stats</strong>函数？从我们以前的工作中，我们知道它使用了<strong>dplyr</strong>。但是，如果我们要使用<strong>统计信息</strong>版本怎么办？</p>
<p>这些函数位于不同的<em>名称空间中</em>。在这些<em>命名空间中</em>搜索函数时，R将遵循特定顺序。可以通过键入以下命令查看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">search()<br></code></pre></td></tr></table></figure>

<p>此列表中的第一项是全局环境，其中包括您定义的所有对象。</p>
<p>那么，如果我们要使用<strong>统计信息</strong> <code>filter</code>而不是<strong>dplyr</strong>过滤器，但如果<strong>dplyr</strong>出现在搜索列表的第一位，可以使用双冒号（<code>::</code>）强制使用特定的名称空间，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">stats::filter<br></code></pre></td></tr></table></figure>

<p>如果我们要绝对确定使用<strong>dplyr</strong> <code>filter</code>，则可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">dplyr::filter<br></code></pre></td></tr></table></figure>

<p>如果要在包中使用函数而不加载整个包，也可以使用双冒号。</p>
<h3 id="四、For循环"><a href="#四、For循环" class="headerlink" title="四、For循环"></a>四、For循环</h3><p>如果不确定是否调用了正确的函数，可以创建一个计算函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">compute_s_n &lt;- function(n)&#123;<br>  x &lt;- 1:n<br>  sum(x)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>for循环示例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>:<span class="hljs-number">5</span>)&#123;<br>  print(i)<br>&#125;<br><span class="hljs-comment">#&gt; [1] 1</span><br><span class="hljs-comment">#&gt; [1] 2</span><br><span class="hljs-comment">#&gt; [1] 3</span><br><span class="hljs-comment">#&gt; [1] 4</span><br><span class="hljs-comment">#&gt; [1] 5</span><br></code></pre></td></tr></table></figure>

<h3 id="五、向量化和函数"><a href="#五、向量化和函数" class="headerlink" title="五、向量化和函数"></a>五、向量化和函数</h3><p><em>向量化</em>比for循环更可取，因为它可以使代码更短，更清晰。我们已经在矢量算术部分中看到了示例。矢量函数是将适用于每个矢量的相同的操作的函数。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">x &lt;- 1:<span class="hljs-number">10</span><br><span class="hljs-built_in">sqrt</span>(x)<br><span class="hljs-comment">#&gt;  [1] 1.00 1.41 1.73 2.00 2.24 2.45 2.65 2.83 3.00 3.16</span><br>y &lt;- 1:<span class="hljs-number">10</span><br>x*y<br><span class="hljs-comment">#&gt;  [1]   1   4   9  16  25  36  49  64  81 100</span><br></code></pre></td></tr></table></figure>

<p>为了进行此计算，不需要for循环。但是，并非所有函数都以这种方式工作。例如，刚刚编写的函数<code>compute_s_n</code>由于它期望标量，因此无法逐个元素地工作。这段代码并未在以下各项的每个条目上运行该函数<code>n</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">n &lt;- 1:<span class="hljs-number">25</span><br>compute_s_n(n)<br></code></pre></td></tr></table></figure>

<p><em>函数</em>是可以帮助我们将相同函数应用于向量，矩阵，数据框或列表中的每个条目的函数。在这里，我们介绍了对数字，逻辑和字符向量进行操作的函数：<code>sapply</code>。</p>
<p>该函数<code>sapply</code>允许我们对任何函数执行按元素操作。下面是它的工作原理：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">x &lt;- 1:10<br>sapply(x, sqrt)<br>#&gt;  [1] 1.00 1.41 1.73 2.00 2.24 2.45 2.65 2.83 3.00 3.16<br></code></pre></td></tr></table></figure>

<p>的每个元素<code>x</code>都传递给函数，<code>sqrt</code>并返回结果。这些结果是串联的。在这种情况下，结果是一个与原始长度相同的向量<code>x</code>。这意味着上面的for循环可以编写如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">n &lt;- 1:25<br>s_n &lt;- sapply(n, compute_s_n)<br></code></pre></td></tr></table></figure>

<p>其他泛函也包括<code>apply</code>，<code>lapply</code>，<code>tapply</code>，<code>mapply</code>，<code>vapply</code>，和<code>replicate</code>。</p>
<h2 id="VIII-idyverse"><a href="#VIII-idyverse" class="headerlink" title="VIII idyverse"></a>VIII idyverse</h2><p>数据存储的首选单位不是矢量，而是数据帧。</p>
<p>通过安装和加载tidyverse软件包来一次加载所有<strong>tidyverse</strong>软件包：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">library(tidyverse)<br></code></pre></td></tr></table></figure>

<h3 id="一、整理数据"><a href="#一、整理数据" class="headerlink" title="一、整理数据"></a>一、整理数据</h3><p>每一行代表一个观察值，而各列代表可用于这些观察值的不同变量，则数据表为<em>整齐的</em>格式。该<code>murders</code>数据集为整齐的数据帧的一个例子。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">#&gt;        state abb region population total</span><br><span class="hljs-comment">#&gt; 1    Alabama  AL  South    4779736   135</span><br><span class="hljs-comment">#&gt; 2     Alaska  AK   West     710231    19</span><br><span class="hljs-comment">#&gt; 3    Arizona  AZ   West    6392017   232</span><br><span class="hljs-comment">#&gt; 4   Arkansas  AR  South    2915918    93</span><br><span class="hljs-comment">#&gt; 5 California  CA   West   37253956  1257</span><br><span class="hljs-comment">#&gt; 6   Colorado  CO   West    5029196    65</span><br></code></pre></td></tr></table></figure>

<p>每一行代表一个州，五列中的每一列都提供与这些州相关的不同变量：名称，缩写，地区，人口和谋杀总数。</p>
<p>以不同的格式提供相同的信息：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">#&gt;       country year fertility</span><br><span class="hljs-comment">#&gt; 1     Germany 1960      2.41</span><br><span class="hljs-comment">#&gt; 2 South Korea 1960      6.16</span><br><span class="hljs-comment">#&gt; 3     Germany 1961      2.44</span><br><span class="hljs-comment">#&gt; 4 South Korea 1961      5.99</span><br><span class="hljs-comment">#&gt; 5     Germany 1962      2.47</span><br><span class="hljs-comment">#&gt; 6 South Korea 1962      5.79</span><br></code></pre></td></tr></table></figure>

<p>这个整齐的数据集提供了多年来两个国家的生育率。这是一个整洁的数据集，因为每一行都显示一个观察值，其中三个变量分别是国家/地区，年份和生育率：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment">#&gt;       country 1960 1961 1962</span><br><span class="hljs-comment">#&gt; 1     Germany 2.41 2.44 2.47</span><br><span class="hljs-comment">#&gt; 2 South Korea 6.16 5.99 5.79</span><br></code></pre></td></tr></table></figure>

<p>提供的信息相同，但是格式有两个重要区别：1）每行包含多个观测值； 2）变量之一year储存在标题中。为了使tidyverse软件包得到最佳使用，需要将数据重塑为<code>tidy</code>格式。</p>
<h3 id="二、处理数据帧"><a href="#二、处理数据帧" class="headerlink" title="二、处理数据帧"></a>二、处理数据帧</h3><p>要通过添加新列来更改数据表，使用<code>mutate</code>。</p>
<p>要将数据表过滤为行的子集，使用<code>filter</code>。</p>
<p>要选择特定列以对数据进行子集化，使用<code>select</code>。</p>
<h4 id="1、使用添加列mutate"><a href="#1、使用添加列mutate" class="headerlink" title="1、使用添加列mutate"></a>1、使用添加列<code>mutate</code></h4><p>函数<code>mutate</code>使用约定将数据帧作为第一个参数，并将变量的名称和值作为第二个参数<code>name = values</code>。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">library(dslabs)<br>data(<span class="hljs-string">&quot;murders&quot;</span>)<br>murders &lt;- mutate(murders, rate = total / population * <span class="hljs-number">100000</span>)<br></code></pre></td></tr></table></figure>

<p><strong>dplyr</strong>的主要功能之一：该软件包中的函数（例如<code>mutate</code>）知道要在第一个参数提供的数据框中查找变量（population和total）。</p>
<p>我们可以看到添加了新列：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">head(murders)<br><span class="hljs-comment">#&gt;        state abb region population total rate</span><br><span class="hljs-comment">#&gt; 1    Alabama  AL  South    4779736   135 2.82</span><br><span class="hljs-comment">#&gt; 2     Alaska  AK   West     710231    19 2.68</span><br><span class="hljs-comment">#&gt; 3    Arizona  AZ   West    6392017   232 3.63</span><br><span class="hljs-comment">#&gt; 4   Arkansas  AR  South    2915918    93 3.19</span><br><span class="hljs-comment">#&gt; 5 California  CA   West   37253956  1257 3.37</span><br><span class="hljs-comment">#&gt; 6   Colorado  CO   West    5029196    65 1.29</span><br></code></pre></td></tr></table></figure>

<p>尽管已经覆盖了原始<code>murders</code>对象，但不会更改加载的对象<code>data(murders)</code>。如果我们<code>murders</code>再次加载数据，原始数据将覆盖我们的变异版本。</p>
<h4 id="2、子集filter"><a href="#2、子集filter" class="headerlink" title="2、子集filter"></a>2、子集<code>filter</code></h4><p><code>filter</code>函数将数据表作为第一个参数，然后将条件语句作为第二个参数</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">filter(murders, rate &lt;= <span class="hljs-number">0.71</span>)<br><span class="hljs-comment">#&gt;           state abb        region population total  rate</span><br><span class="hljs-comment">#&gt; 1        Hawaii  HI          West    1360301     7 0.515</span><br><span class="hljs-comment">#&gt; 2          Iowa  IA North Central    3046355    21 0.689</span><br><span class="hljs-comment">#&gt; 3 New Hampshire  NH     Northeast    1316470     5 0.380</span><br><span class="hljs-comment">#&gt; 4  North Dakota  ND North Central     672591     4 0.595</span><br><span class="hljs-comment">#&gt; 5       Vermont  VT     Northeast     625741     2 0.320</span><br></code></pre></td></tr></table></figure>

<h4 id="3、select"><a href="#3、select" class="headerlink" title="3、select"></a>3、<code>select</code></h4><p>使用<strong>dplyr</strong> <code>select</code>函数查看其中几列：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">new_table &lt;- select(murders, state, region, rate)<br>filter(new_table, rate &lt;= <span class="hljs-number">0.71</span>)<br><span class="hljs-comment">#&gt;           state        region  rate</span><br><span class="hljs-comment">#&gt; 1        Hawaii          West 0.515</span><br><span class="hljs-comment">#&gt; 2          Iowa North Central 0.689</span><br><span class="hljs-comment">#&gt; 3 New Hampshire     Northeast 0.380</span><br><span class="hljs-comment">#&gt; 4  North Dakota North Central 0.595</span><br><span class="hljs-comment">#&gt; 5       Vermont     Northeast 0.320</span><br></code></pre></td></tr></table></figure>

<h3 id="三、管道：-gt"><a href="#三、管道：-gt" class="headerlink" title="三、管道：%&gt;%"></a>三、管道：<code>%&gt;%</code></h3><p>发送一个函数的结果到另一个，使用管道：<code>%&gt;%</code>。</p>
<p>原始数据 →  选择 →  过滤 original data → select → filter </p>
<p>对于这样的操作，我们可以使用pipe <code>%&gt;%</code>。代码如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;% select(state, region, rate) %&gt;% filter(rate &lt;= <span class="hljs-number">0.71</span>)<br><span class="hljs-comment">#&gt;           state        region  rate</span><br><span class="hljs-comment">#&gt; 1        Hawaii          West 0.515</span><br><span class="hljs-comment">#&gt; 2          Iowa North Central 0.689</span><br><span class="hljs-comment">#&gt; 3 New Hampshire     Northeast 0.380</span><br><span class="hljs-comment">#&gt; 4  North Dakota North Central 0.595</span><br><span class="hljs-comment">#&gt; 5       Vermont     Northeast 0.320</span><br></code></pre></td></tr></table></figure>

<p>管道<em>将</em>管道左侧的结果<em>发送</em>为管道右侧函数的第一个参数。</p>
<p>eg：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">16 %&gt;% <span class="hljs-built_in">sqrt</span>()<br><span class="hljs-comment">#&gt; [1] 4</span><br></code></pre></td></tr></table></figure>

<p>继续通过以下方式传递值：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">16 %&gt;% <span class="hljs-built_in">sqrt</span>() %&gt;% log2()<br><span class="hljs-comment">#&gt; [1] 2</span><br></code></pre></td></tr></table></figure>

<p>以上声明等同于<code>log2(sqrt(16))</code>。</p>
<p>可以定义其他参数，而第一个参数已经定义：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">16 %&gt;% <span class="hljs-built_in">sqrt</span>() %&gt;% <span class="hljs-built_in">log</span>(base = <span class="hljs-number">2</span>)<br><span class="hljs-comment">#&gt; [1] 2</span><br></code></pre></td></tr></table></figure>

<p>当使用带有数据帧和<strong>dplyr</strong>的管道时，不再需要指定所需的第一个参数，因为<strong>dplyr</strong>函数都将数据作为第一个参数。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;% select(state, region, rate) %&gt;% filter(rate &lt;= <span class="hljs-number">0.71</span>)<br></code></pre></td></tr></table></figure>

<h3 id="四、汇总数据"><a href="#四、汇总数据" class="headerlink" title="四、汇总数据"></a>四、汇总数据</h3><h4 id="1、-summarize"><a href="#1、-summarize" class="headerlink" title="1、 summarize"></a>1、 <code>summarize</code></h4><p><strong>dplyr中</strong>的<code>summarize</code>函数可以计算摘要统计信息。</p>
<p>eg：从一个基于高度的简单示例开始。该数据集包括学生在课堂调查中报告的身高和性别。<code>heights</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">library(dplyr)<br>library(dslabs)<br>data(heights)<br></code></pre></td></tr></table></figure>

<p>以下代码计算女性的平均偏差和标准偏差：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">s &lt;- heights %&gt;% <br>  filter(sex == <span class="hljs-string">&quot;Female&quot;</span>) %&gt;%<br>  summarize(average = mean(height), standard_deviation = sd(height))<br>s<br><span class="hljs-comment">#&gt;   average standard_deviation</span><br><span class="hljs-comment">#&gt; 1    64.9               3.76</span><br></code></pre></td></tr></table></figure>

<p>将原始数据表作为输入，对其进行过滤以仅保留雌性，然后生成仅具有高度的平均值和标准偏差的新汇总表。也可以使用<code>average</code>和<code>standard_deviation</code>，或者使用相同的其他名称。</p>
<p>因为存储在其中的结果表<code>s</code>是一个数据帧，所以我们可以使用访问器访问组件<code>$</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">s$average<br><span class="hljs-comment">#&gt; [1] 64.9</span><br>s$standard_deviation<br><span class="hljs-comment">#&gt; [1] 3.76</span><br></code></pre></td></tr></table></figure>

<p>在<code>summarize</code>编写<code>mean(height)</code>的函数调用，函数将访问名称为“ height”的列，然后计算所得数值向量的平均值。</p>
<p>eg:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">heights %&gt;% <br>  filter(sex == <span class="hljs-string">&quot;Female&quot;</span>) %&gt;%<br>  summarize(median = median(height), minimum = <span class="hljs-built_in">min</span>(height), <br>            maximum = <span class="hljs-built_in">max</span>(height))<br><span class="hljs-comment">#&gt;   median minimum maximum</span><br><span class="hljs-comment">#&gt; 1     65      51      79</span><br></code></pre></td></tr></table></figure>

<p>使用<code>quantile</code>函数在一行中获得这三个值：</p>
<p>eg:<code>quantile(x, c(0,0.5,1))</code>返回向量的最小值（第0个百分位数），中位数（第50个百分位数）和最大值（第100个百分位数）<code>x</code>。以下代码将会报错:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">heights %&gt;% <br>  filter(sex == <span class="hljs-string">&quot;Female&quot;</span>) %&gt;%<br>  summarize(<span class="hljs-built_in">range</span> = quantile(height, <span class="hljs-built_in">c</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>)))<br></code></pre></td></tr></table></figure>

<p>因为使用function <code>summarize</code>，我们只能调用返回单个值的函数。</p>
<p>计算美国的平均谋杀率：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">murders &lt;- murders %&gt;% mutate(rate = total/population*<span class="hljs-number">100000</span>)<br></code></pre></td></tr></table></figure>

<p>美国的谋杀率<strong>不是</strong>该州谋杀率的平均值：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">summarize(murders, mean(rate))<br><span class="hljs-comment">#&gt;   mean(rate)</span><br><span class="hljs-comment">#&gt; 1       2.78</span><br></code></pre></td></tr></table></figure>

<p>因为在上述计算中，小状态的权重与大状态的权重相同。美国谋杀率是美国谋杀总数除以美国总人口。因此正确的计算是：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">us_murder_rate &lt;- murders %&gt;%<br>  summarize(rate = <span class="hljs-built_in">sum</span>(total) / <span class="hljs-built_in">sum</span>(population) * <span class="hljs-number">100000</span>)<br>us_murder_rate<br><span class="hljs-comment">#&gt;   rate</span><br><span class="hljs-comment">#&gt; 1 3.03</span><br></code></pre></td></tr></table></figure>

<p>此计算会按其大小成比例地计算较大的状态，从而得出较大的值。</p>
<h4 id="2、-pull"><a href="#2、-pull" class="headerlink" title="2、 pull"></a>2、 <code>pull</code></h4><p><code>us_murder_rate</code>上面定义的对象仅代表一个数字。但是我们将其存储在数据帧中：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(us_murder_rate)<br><span class="hljs-comment">#&gt; [1] &quot;data.frame&quot;</span><br></code></pre></td></tr></table></figure>

<p>因为与大多数<strong>dplyr</strong>函数一样，<code>summarize</code>总是返回一个数据帧。</p>
<p>当管道数据对象时，可以使用该<code>pull</code>函数访问该对象及其列。</p>
<p>eg:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">us_murder_rate %&gt;% pull(rate)<br><span class="hljs-comment">#&gt; [1] 3.03</span><br></code></pre></td></tr></table></figure>

<p>这将返回等于<code>rate</code>列中的值。<code>us_murder_rate us_murder_rate$rate</code></p>
<p>要使用一行代码从原始数据表中获取一个数字，我们可以输入：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">us_murder_rate &lt;- murders %&gt;% <br>  summarize(rate = <span class="hljs-built_in">sum</span>(total) / <span class="hljs-built_in">sum</span>(population) * <span class="hljs-number">100000</span>) %&gt;%<br>  pull(rate)<br><br>us_murder_rate<br><span class="hljs-comment">#&gt; [1] 3.03</span><br></code></pre></td></tr></table></figure>

<p>现在是一个数字：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(us_murder_rate)<br><span class="hljs-comment">#&gt; [1] &quot;numeric&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="3、先分组然后汇总group-by"><a href="#3、先分组然后汇总group-by" class="headerlink" title="3、先分组然后汇总group_by"></a>3、先分组然后汇总<code>group_by</code></h3><p>数据探索中的常见操作是先将数据分为几组，然后为每组计算汇总。例如，我们可能要分别计算男性和女性身高的平均值和标准差。<code>group_by</code>函数可以做到这一点。</p>
<p>输入：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs R">heights %&gt;% group_by(sex)<br><span class="hljs-comment">#&gt; # A tibble: 1,050 x 2</span><br><span class="hljs-comment">#&gt; # Groups:   sex [2]</span><br><span class="hljs-comment">#&gt;   sex   height</span><br><span class="hljs-comment">#&gt;   &lt;fct&gt;  &lt;dbl&gt;</span><br><span class="hljs-comment">#&gt; 1 Male      75</span><br><span class="hljs-comment">#&gt; 2 Male      70</span><br><span class="hljs-comment">#&gt; 3 Male      68</span><br><span class="hljs-comment">#&gt; 4 Male      74</span><br><span class="hljs-comment">#&gt; 5 Male      61</span><br><span class="hljs-comment">#&gt; # … with 1,045 more rows</span><br></code></pre></td></tr></table></figure>

<p>对分组后的数据进行汇总：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">heights %&gt;% <br>  group_by(sex) %&gt;%<br>  summarize(average = mean(height), standard_deviation = sd(height))<br><span class="hljs-comment">#&gt; # A tibble: 2 x 3</span><br><span class="hljs-comment">#&gt;   sex    average standard_deviation</span><br><span class="hljs-comment">#&gt;   &lt;fct&gt;    &lt;dbl&gt;              &lt;dbl&gt;</span><br><span class="hljs-comment">#&gt; 1 Female    64.9               3.76</span><br><span class="hljs-comment">#&gt; 2 Male      69.3               3.61</span><br></code></pre></td></tr></table></figure>

<p>该<code>summarize</code>功能将摘要分别应用于每个组。</p>
<p>eg：计算该国四个地区的平均谋杀率：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;% <br>  group_by(region) %&gt;%<br>  summarize(median_rate = median(rate))<br><span class="hljs-comment">#&gt; # A tibble: 4 x 2</span><br><span class="hljs-comment">#&gt;   region        median_rate</span><br><span class="hljs-comment">#&gt;   &lt;fct&gt;               &lt;dbl&gt;</span><br><span class="hljs-comment">#&gt; 1 Northeast            1.80</span><br><span class="hljs-comment">#&gt; 2 South                3.40</span><br><span class="hljs-comment">#&gt; 3 North Central        1.97</span><br><span class="hljs-comment">#&gt; 4 West                 1.29</span><br></code></pre></td></tr></table></figure>

<h3 id="五、排序数据框"><a href="#五、排序数据框" class="headerlink" title="五、排序数据框"></a>五、排序数据框</h3><p>检查数据集时，通常可以按不同的列对表进行排序。我们知道<code>order</code>和 <code>sort</code>函数，但是对于排序整个表，<strong>dplyr</strong>函数<code>arrange</code>很有用。例如，在这里我们按人口数量对州进行排序：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;%<br>  arrange(population) %&gt;%<br>  head()<br><span class="hljs-comment">#&gt;                  state abb        region population total   rate</span><br><span class="hljs-comment">#&gt; 1              Wyoming  WY          West     563626     5  0.887</span><br><span class="hljs-comment">#&gt; 2 District of Columbia  DC         South     601723    99 16.453</span><br><span class="hljs-comment">#&gt; 3              Vermont  VT     Northeast     625741     2  0.320</span><br><span class="hljs-comment">#&gt; 4         North Dakota  ND North Central     672591     4  0.595</span><br><span class="hljs-comment">#&gt; 5               Alaska  AK          West     710231    19  2.675</span><br><span class="hljs-comment">#&gt; 6         South Dakota  SD North Central     814180     8  0.983</span><br></code></pre></td></tr></table></figure>

<p>为了按谋杀率从最低到最高查看各州，改用<code>rate</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;% <br>  arrange(rate) %&gt;%<br>  head()<br><span class="hljs-comment">#&gt;           state abb        region population total  rate</span><br><span class="hljs-comment">#&gt; 1       Vermont  VT     Northeast     625741     2 0.320</span><br><span class="hljs-comment">#&gt; 2 New Hampshire  NH     Northeast    1316470     5 0.380</span><br><span class="hljs-comment">#&gt; 3        Hawaii  HI          West    1360301     7 0.515</span><br><span class="hljs-comment">#&gt; 4  North Dakota  ND North Central     672591     4 0.595</span><br><span class="hljs-comment">#&gt; 5          Iowa  IA North Central    3046355    21 0.689</span><br><span class="hljs-comment">#&gt; 6         Idaho  ID          West    1567582    12 0.766</span><br></code></pre></td></tr></table></figure>

<p>arrange默认按升序排列。在<strong>dplyr中</strong>，函数<code>desc</code>将向量转换为降序排列。要按降序对表格进行排序，我们可以输入：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;% <br>  arrange(desc(rate)) <br></code></pre></td></tr></table></figure>

<h4 id="1、嵌套排序"><a href="#1、嵌套排序" class="headerlink" title="1、嵌套排序"></a>1、嵌套排序</h4><p>可以先按<code>region</code>排序，然后在<code>region</code>内按谋杀率排序：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;% <br>  arrange(region, rate) %&gt;% <br>  head()<br><span class="hljs-comment">#&gt;           state abb    region population total  rate</span><br><span class="hljs-comment">#&gt; 1       Vermont  VT Northeast     625741     2 0.320</span><br><span class="hljs-comment">#&gt; 2 New Hampshire  NH Northeast    1316470     5 0.380</span><br><span class="hljs-comment">#&gt; 3         Maine  ME Northeast    1328361    11 0.828</span><br><span class="hljs-comment">#&gt; 4  Rhode Island  RI Northeast    1052567    16 1.520</span><br><span class="hljs-comment">#&gt; 5 Massachusetts  MA Northeast    6547629   118 1.802</span><br><span class="hljs-comment">#&gt; 6      New York  NY Northeast   19378102   517 2.668</span><br></code></pre></td></tr></table></figure>

<h4 id="2、top-n"><a href="#2、top-n" class="headerlink" title="2、top_n"></a>2、<code>top_n</code></h4><p>使用函数<code>head</code>来避免页面被整个数据集填满。如果希望看到更大的比例，可以使用该<code>top_n</code>函数。函数将数据帧作为第一个参数，第二个为显示的行数，第三个为进行过滤的变量。这是如何查看前5行的示例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;% top_n(<span class="hljs-number">5</span>, rate)<br><span class="hljs-comment">#&gt;                  state abb        region population total  rate</span><br><span class="hljs-comment">#&gt; 1 District of Columbia  DC         South     601723    99 16.45</span><br><span class="hljs-comment">#&gt; 2            Louisiana  LA         South    4533372   351  7.74</span><br><span class="hljs-comment">#&gt; 3             Maryland  MD         South    5773552   293  5.07</span><br><span class="hljs-comment">#&gt; 4             Missouri  MO North Central    5988927   321  5.36</span><br><span class="hljs-comment">#&gt; 5       South Carolina  SC         South    4625364   207  4.48</span><br></code></pre></td></tr></table></figure>

<p>请注意，行未按<code>rate</code>排序，仅进行了过滤。如果要排序，则需要使用<code>arrange</code>。如果第三个参数保留为空白，<code>top_n</code>则按最后一列过滤。</p>
<h3 id="六、小标题"><a href="#六、小标题" class="headerlink" title="六、小标题"></a>六、小标题</h3><p>eg：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;% group_by(region)<br><span class="hljs-comment">#&gt; # A tibble: 51 x 6</span><br><span class="hljs-comment">#&gt; # Groups:   region [4]</span><br><span class="hljs-comment">#&gt;   state      abb   region population total  rate</span><br><span class="hljs-comment">#&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="hljs-comment">#&gt; 1 Alabama    AL    South     4779736   135  2.82</span><br><span class="hljs-comment">#&gt; 2 Alaska     AK    West       710231    19  2.68</span><br><span class="hljs-comment">#&gt; 3 Arizona    AZ    West      6392017   232  3.63</span><br><span class="hljs-comment">#&gt; 4 Arkansas   AR    South     2915918    93  3.19</span><br><span class="hljs-comment">#&gt; 5 California CA    West     37253956  1257  3.37</span><br><span class="hljs-comment">#&gt; # … with 46 more rows</span><br></code></pre></td></tr></table></figure>

<p>使用以下方法了解返回对象的类：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;% group_by(region) %&gt;% <span class="hljs-built_in">class</span>()<br><span class="hljs-comment">#&gt; [1] &quot;grouped_df&quot; &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span><br></code></pre></td></tr></table></figure>

<h4 id="1、小标题显示效果更好"><a href="#1、小标题显示效果更好" class="headerlink" title="1、小标题显示效果更好"></a>1、小标题显示效果更好</h4><p>小标题的打印方法比数据框的可读性更高。<code>murders</code>如果将打印转换为小标题，则比较打印的输出和谋杀的输出。可以使用来完成<code>as_tibble(murders)</code>。如果使用RStudio，则小标题的输出将调整为窗口大小。可以R控制台的宽度，显示更多/更少列的方式。</p>
<h4 id="2、小标题的子集是小标题"><a href="#2、小标题的子集是小标题" class="headerlink" title="2、小标题的子集是小标题"></a>2、小标题的子集是小标题</h4><p>如果对数据框的列进行子集化，则可能会获得一个非数据框的对象，例如矢量或标量。例如：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(murders[,<span class="hljs-number">4</span>])<br><span class="hljs-comment">#&gt; [1] &quot;numeric&quot;</span><br></code></pre></td></tr></table></figure>

<p>如果不是数据帧，不会报错：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(as_tibble(murders)[,<span class="hljs-number">4</span>])<br><span class="hljs-comment">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span><br></code></pre></td></tr></table></figure>

<p>在tidyverse中，函数需要数据帧作为输入。</p>
<p>对于小标题，要访问定义列的向量，而不获取数据帧，则需要使用访问器<code>$</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(as_tibble(murders)$population)<br><span class="hljs-comment">#&gt; [1] &quot;numeric&quot;</span><br></code></pre></td></tr></table></figure>

<p>如果访问不存在的列，则小标题警告。</p>
<p>eg:写<code>Population</code>了<code>population</code>以下内容：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">murders$Population<br><span class="hljs-comment">#&gt; NULL</span><br></code></pre></td></tr></table></figure>

<p>如果返回<code>NULL</code>而没有警告，可以这样转换为警告：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">as_tibble(murders)$Population<br>#&gt; Warning: Unknown or uninitialised column: &#x27;Population&#x27;.<br>#&gt; NULL<br></code></pre></td></tr></table></figure>

<h4 id="3、小标题可以包含复杂的条目"><a href="#3、小标题可以包含复杂的条目" class="headerlink" title="3、小标题可以包含复杂的条目"></a>3、小标题可以包含复杂的条目</h4><p>尽管数据帧的列需要是数字，字符串或逻辑值的向量，但小标题可以具有更复杂的对象，例如列表或函数</p>
<p>eg：创建小标题：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">tibble(id = <span class="hljs-built_in">c</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), func = <span class="hljs-built_in">c</span>(mean, median, sd))<br><span class="hljs-comment">#&gt; # A tibble: 3 x 2</span><br><span class="hljs-comment">#&gt;      id func  </span><br><span class="hljs-comment">#&gt;   &lt;dbl&gt; &lt;list&gt;</span><br><span class="hljs-comment">#&gt; 1     1 &lt;fn&gt;  </span><br><span class="hljs-comment">#&gt; 2     2 &lt;fn&gt;  </span><br><span class="hljs-comment">#&gt; 3     3 &lt;fn&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="4、小标题可以分组"><a href="#4、小标题可以分组" class="headerlink" title="4、小标题可以分组"></a>4、小标题可以分组</h4><p>该函数<code>group_by</code>返回一种特殊的小标题：分组小标题。此类存储的信息表明哪些行属于哪些组。可以通过<code>summarize</code>功能知道组信息。</p>
<h4 id="5、使用tibble代替创建小标题data-frame"><a href="#5、使用tibble代替创建小标题data-frame" class="headerlink" title="5、使用tibble代替创建小标题data.frame"></a>5、使用<code>tibble</code>代替创建小标题<code>data.frame</code></h4><p>使用<code>tibble</code>函数创建自己的数据帧：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">grades &lt;- tibble(<span class="hljs-built_in">names</span> = <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;John&quot;</span>, <span class="hljs-string">&quot;Juan&quot;</span>, <span class="hljs-string">&quot;Jean&quot;</span>, <span class="hljs-string">&quot;Yao&quot;</span>), <br>                     exam_1 = <span class="hljs-built_in">c</span>(<span class="hljs-number">95</span>, <span class="hljs-number">80</span>, <span class="hljs-number">90</span>, <span class="hljs-number">85</span>), <br>                     exam_2 = <span class="hljs-built_in">c</span>(<span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">85</span>, <span class="hljs-number">90</span>))<br></code></pre></td></tr></table></figure>

<p>Basic R（未加载软件包）具有名称非常相似的函数<code>data.frame</code>，可用于创建常规数据帧而不是小标题。默认情况下，将<code>data.frame</code>字符强制转换为factor，而不提供警告或消息：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">grades &lt;- data.frame(<span class="hljs-built_in">names</span> = <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;John&quot;</span>, <span class="hljs-string">&quot;Juan&quot;</span>, <span class="hljs-string">&quot;Jean&quot;</span>, <span class="hljs-string">&quot;Yao&quot;</span>), <br>                     exam_1 = <span class="hljs-built_in">c</span>(<span class="hljs-number">95</span>, <span class="hljs-number">80</span>, <span class="hljs-number">90</span>, <span class="hljs-number">85</span>), <br>                     exam_2 = <span class="hljs-built_in">c</span>(<span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">85</span>, <span class="hljs-number">90</span>))<br><span class="hljs-built_in">class</span>(grades$<span class="hljs-built_in">names</span>)<br><span class="hljs-comment">#&gt; [1] &quot;factor&quot;</span><br></code></pre></td></tr></table></figure>

<p>为了避免这种情况，使用参数<code>stringsAsFactors</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">grades &lt;- data.frame(<span class="hljs-built_in">names</span> = <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;John&quot;</span>, <span class="hljs-string">&quot;Juan&quot;</span>, <span class="hljs-string">&quot;Jean&quot;</span>, <span class="hljs-string">&quot;Yao&quot;</span>), <br>                     exam_1 = <span class="hljs-built_in">c</span>(<span class="hljs-number">95</span>, <span class="hljs-number">80</span>, <span class="hljs-number">90</span>, <span class="hljs-number">85</span>), <br>                     exam_2 = <span class="hljs-built_in">c</span>(<span class="hljs-number">90</span>, <span class="hljs-number">85</span>, <span class="hljs-number">85</span>, <span class="hljs-number">90</span>),<br>                     stringsAsFactors = <span class="hljs-literal">FALSE</span>)<br><span class="hljs-built_in">class</span>(grades$<span class="hljs-built_in">names</span>)<br><span class="hljs-comment">#&gt; [1] &quot;character&quot;</span><br></code></pre></td></tr></table></figure>

<p>将常规数据帧转换为小标题，使用<code>as_tibble</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">as_tibble(grades) %&gt;% <span class="hljs-built_in">class</span>()<br><span class="hljs-comment">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="七、点运算符"><a href="#七、点运算符" class="headerlink" title="七、点运算符"></a>七、点运算符</h3><p>使用管道<code>%&gt;%</code>，当我们处理数据帧时，不必一直命名新对象。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">tab_1 &lt;- filter(murders, region == <span class="hljs-string">&quot;South&quot;</span>)<br>tab_2 &lt;- mutate(tab_1, rate = total / population * <span class="hljs-number">10</span>^<span class="hljs-number">5</span>)<br>rates &lt;- tab_2$rate<br>median(rates)<br><span class="hljs-comment">#&gt; [1] 3.4</span><br></code></pre></td></tr></table></figure>

<p>可以通过输入以下内容来避免定义任何新的中间对象：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">filter(murders, region == <span class="hljs-string">&quot;South&quot;</span>) %&gt;% <br>  mutate(rate = total / population * <span class="hljs-number">10</span>^<span class="hljs-number">5</span>) %&gt;% <br>  summarize(median = median(rate)) %&gt;%<br>  pull(median)<br><span class="hljs-comment">#&gt; [1] 3.4</span><br></code></pre></td></tr></table></figure>

<p>函数将数据帧作为第一个参数，如果要访问数据帧的组件，使用点运算符。</p>
<p>eg：在不使用<code>pull</code>函数的情况下访问速率向量</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">rates &lt;-   filter(murders, region == <span class="hljs-string">&quot;South&quot;</span>) %&gt;% <br>  mutate(rate = total / population * <span class="hljs-number">10</span>^<span class="hljs-number">5</span>) %&gt;% <br>  .$rate<br>median(rates)<br><span class="hljs-comment">#&gt; [1] 3.4</span><br></code></pre></td></tr></table></figure>

<h3 id="八、-do"><a href="#八、-do" class="headerlink" title="八、 do"></a>八、 <code>do</code></h3><p>tidyverse函数知道如何解释分组的小标题，为了使通过管道<code>%&gt;%</code>的字符串命令变得容易，tidyverse函数始终返回数据帧，这确保了函数的输出被接受为另一个函数的输入。但是大多数R函数不能识别分组的小动作，也不返回数据帧。</p>
<p>用<code>quantile</code>在一次调用中用于获取最小值，中值和最大值，则会收到错误消息：<code>Error: expecting result of length one, got : 2</code>。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">data(heights)<br>heights %&gt;% <br>  filter(sex == <span class="hljs-string">&quot;Female&quot;</span>) %&gt;%<br>  summarize(<span class="hljs-built_in">range</span> = quantile(height, <span class="hljs-built_in">c</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>)))<br></code></pre></td></tr></table></figure>

<p>可以使用该<code>do</code>功能来解决此问题。</p>
<p>首先编写一个适合tidyverse方法的函数，它接收一个数据帧并返回一个数据帧：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">my_summary &lt;- <span class="hljs-keyword">function</span>(dat)&#123;<br>  x &lt;- quantile(dat$height, <span class="hljs-built_in">c</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>))<br>  tibble(<span class="hljs-built_in">min</span> = x[<span class="hljs-number">1</span>], median = x[<span class="hljs-number">2</span>], <span class="hljs-built_in">max</span> = x[<span class="hljs-number">3</span>])<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以将该函数应用于高度数据集以获取摘要：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">heights %&gt;% <br>  group_by(sex) %&gt;% <br>  my_summary<br><span class="hljs-comment">#&gt; # A tibble: 1 x 3</span><br><span class="hljs-comment">#&gt;     min median   max</span><br><span class="hljs-comment">#&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="hljs-comment">#&gt; 1    50   68.5  82.7</span><br></code></pre></td></tr></table></figure>

<p>我们需要每种性别的摘要，而代码仅返回一个摘要。这是因为<code>my_summary</code>不是tidyverse的一部分，并且不知道如何处理分组的小标题。用<code>do</code>建立此连接：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs R">heights %&gt;% <br>  group_by(sex) %&gt;% <br>  do(my_summary(.))<br><span class="hljs-comment">#&gt; # A tibble: 2 x 4</span><br><span class="hljs-comment">#&gt; # Groups:   sex [2]</span><br><span class="hljs-comment">#&gt;   sex      min median   max</span><br><span class="hljs-comment">#&gt;   &lt;fct&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="hljs-comment">#&gt; 1 Female    51   65.0  79  </span><br><span class="hljs-comment">#&gt; 2 Male      50   69    82.7</span><br></code></pre></td></tr></table></figure>

<p>这里需要使用点运算符。如果不使用点，那么<code>my_summary</code>有<em>没有参数</em>，并返回一个错误告诉我们，<code>argument &quot;dat&quot;</code>缺少。可以通过键入以下内容查看错误：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">heights %&gt;% <br>  group_by(sex) %&gt;% <br>  do(my_summary())<br></code></pre></td></tr></table></figure>

<p>如果不使用括号，则不会执行该函数，而是<code>do</code>尝试返回该函数。由于<code>do</code>必须始终返回数据帧，因此会产生错误。可以通过键入以下内容查看错误：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">heights %&gt;% <br>  group_by(sex) %&gt;% <br>  do(my_summary)<br></code></pre></td></tr></table></figure>

<h3 id="九、purrr包"><a href="#九、purrr包" class="headerlink" title="九、purrr包"></a>九、<strong>purrr</strong>包</h3><p>构造一个函数，并使用<code>sapply</code>来计算<code>n</code>个这样的值的和：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">compute_s_n &lt;- <span class="hljs-keyword">function</span>(n)&#123;<br>  x &lt;- 1:n<br>  <span class="hljs-built_in">sum</span>(x)<br>&#125;<br>n &lt;- 1:<span class="hljs-number">25</span><br>s_n &lt;- sapply(n, compute_s_n)<br></code></pre></td></tr></table></figure>

<p>将相同功能或过程应用于对象元素的操作在数据分析中非常常见。</p>
<p><code>sapply</code>可以返回几种不同的对象类型；例如，我们可能希望从一行代码获得数字结果，但<code>sapply</code>在某些情况下可能会将我们的结果转换为字符。</p>
<p><strong>purrr</strong>函数将返回指定类型的对象，或者如果不可能的话将返回错误。</p>
<p>eg：<strong>purrr</strong>函数<code>map</code>返回一个列表：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">library(purrr)<br>s_n &lt;- map(n, compute_s_n)<br><span class="hljs-built_in">class</span>(s_n)<br><span class="hljs-comment">#&gt; [1] &quot;list&quot;</span><br></code></pre></td></tr></table></figure>

<p>如果想要一个数值向量，可以改用<code>map_dbl</code>返回数值向量：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">s_n &lt;- map_dbl(n, compute_s_n)<br><span class="hljs-built_in">class</span>(s_n)<br><span class="hljs-comment">#&gt; [1] &quot;numeric&quot;</span><br></code></pre></td></tr></table></figure>

<p>这将产生与<code>sapply</code>上面显示的调用相同的结果。</p>
<p>与tidyverse进行交互的<strong>purrr</strong>函数<code>map_df</code>:返回一个tibble数据帧。但是，被调用的函数需要返回带有名称的向量或列表。因此，以下代码将导致<code>Argument 1 must have names</code>错误：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">s_n &lt;- map_df(n, compute_s_n)<br></code></pre></td></tr></table></figure>

<p>需要更改功能以使其工作：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">compute_s_n &lt;- <span class="hljs-keyword">function</span>(n)&#123;<br>  x &lt;- 1:n<br>  tibble(<span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span>(x))<br>&#125;<br>s_n &lt;- map_df(n, compute_s_n)<br></code></pre></td></tr></table></figure>

<h3 id="十、-Tidyverse条件"><a href="#十、-Tidyverse条件" class="headerlink" title="十、 Tidyverse条件"></a>十、 Tidyverse条件</h3><h4 id="1、-case-when"><a href="#1、-case-when" class="headerlink" title="1、 case_when"></a>1、 <code>case_when</code></h4><p><code>case_when</code>函数:向量化条件语句</p>
<p>与<code>ifelse</code>just <code>TRUE</code>或相反，它可以输出任意数量的值<code>FALSE</code>。</p>
<p>eg：将数字分为负数，正数和0：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">x &lt;- <span class="hljs-built_in">c</span>(-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>case_when(x &lt; <span class="hljs-number">0</span> ~ <span class="hljs-string">&quot;Negative&quot;</span>, <br>          x &gt; <span class="hljs-number">0</span> ~ <span class="hljs-string">&quot;Positive&quot;</span>, <br>          <span class="hljs-literal">TRUE</span>  ~ <span class="hljs-string">&quot;Zero&quot;</span>)<br><span class="hljs-comment">#&gt; [1] &quot;Negative&quot; &quot;Negative&quot; &quot;Zero&quot;     &quot;Positive&quot; &quot;Positive&quot;</span><br></code></pre></td></tr></table></figure>

<p>此函数的常见用法是根据现有变量定义分类变量。例如，假设我们要比较四个州的谋杀率：<em>新英格兰</em>，<em>西海岸</em>，<em>南部</em>和<em>其他州</em>。对于每个州，我们需要询问它是否在新英格兰，如果不是，则询问它是否在西海岸，如果不是，则询问它是否在南部，如果不是，则分配<em>其他州</em>。这是我们<code>case_when</code>用来执行此操作的方法：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs R">murders %&gt;% <br>  mutate(group = case_when(<br>    abb %in% <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;ME&quot;</span>, <span class="hljs-string">&quot;NH&quot;</span>, <span class="hljs-string">&quot;VT&quot;</span>, <span class="hljs-string">&quot;MA&quot;</span>, <span class="hljs-string">&quot;RI&quot;</span>, <span class="hljs-string">&quot;CT&quot;</span>) ~ <span class="hljs-string">&quot;New England&quot;</span>,<br>    abb %in% <span class="hljs-built_in">c</span>(<span class="hljs-string">&quot;WA&quot;</span>, <span class="hljs-string">&quot;OR&quot;</span>, <span class="hljs-string">&quot;CA&quot;</span>) ~ <span class="hljs-string">&quot;West Coast&quot;</span>,<br>    region == <span class="hljs-string">&quot;South&quot;</span> ~ <span class="hljs-string">&quot;South&quot;</span>,<br>    <span class="hljs-literal">TRUE</span> ~ <span class="hljs-string">&quot;Other&quot;</span>)) %&gt;%<br>  group_by(group) %&gt;%<br>  summarize(rate = <span class="hljs-built_in">sum</span>(total) / <span class="hljs-built_in">sum</span>(population) * <span class="hljs-number">10</span>^<span class="hljs-number">5</span>) <br><span class="hljs-comment">#&gt; # A tibble: 4 x 2</span><br><span class="hljs-comment">#&gt;   group        rate</span><br><span class="hljs-comment">#&gt;   &lt;chr&gt;       &lt;dbl&gt;</span><br><span class="hljs-comment">#&gt; 1 New England  1.72</span><br><span class="hljs-comment">#&gt; 2 Other        2.71</span><br><span class="hljs-comment">#&gt; 3 South        3.63</span><br><span class="hljs-comment">#&gt; 4 West Coast   2.90</span><br></code></pre></td></tr></table></figure>

<h4 id="2、-between"><a href="#2、-between" class="headerlink" title="2、 between"></a>2、 <code>between</code></h4><p>数据分析中的常见操作是确定值是否落在间隔内。可以使用条件检查，例如，要检查向量的元素<code>x</code>是否在之间<code>a</code>，<code>b</code>我们可以输入</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">x &gt;= a &amp; x &lt;= b<br></code></pre></td></tr></table></figure>

<p><code>between</code>功能执行相同的操作：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">between(x, a, b)<br></code></pre></td></tr></table></figure>

<h2 id="IX-导入数据"><a href="#IX-导入数据" class="headerlink" title="IX 导入数据"></a>IX 导入数据</h2><p>科研情况下需要从文件，数据库或其他来源将数据导入R。当前，最常见的存储和共享数据以供分析的方法之一是通过电子电子表格。电子表格将数据存储在行和列中。它基本上是数据帧的文件版本。将此类表保存到计算机文件时，需要一种方法来定义新行或新列何时结束而另一行开始。这又定义了存储单个值的单元格。</p>
<p>当使用文本文件创建电子表格时（例如使用简单的文本编辑器创建的电子表格），将用return定义新行，并使用一些预定义的特殊字符分隔列。最常见的字符是逗号（<code>,</code>），分号（<code>;</code>），空格（）和制表符（预设数量的空格或<code>\t</code>）。这是一个用逗号分隔的文件通过基本文本编辑器打开后的样子的示例：</p>
<p><img src="https://rafalab.github.io/dsbook/R/img/csv-file.png" alt="img"></p>
<p>第一行包含列名，而不是数据。我们称其为<em>标头</em>，当我们从电子表格中读取数据时，重要的是要知道文件是否具有标头。大多数读取功能都假定有标头。要知道文件是否具有标题，可以在尝试读取文件之前先查看文件。可以使用文本编辑器或RStudio来完成。在RStudio中，我们可以通过在编辑器中打开文件或导航到文件位置，双击文件，然后单击<em>View File来实现</em>。</p>
<p>但是，并非所有电子表格文件都为文本格式。在浏览器上呈现的Google表格就是一个例子。另一个示例是Microsoft Excel使用的专有格式。无法使用文本编辑器查看这些内容。尽管如此，由于Microsoft Excel软件的广泛使用，此格式仍被广泛使用。</p>
<h3 id="1、路径和工作目录"><a href="#1、路径和工作目录" class="headerlink" title="1、路径和工作目录"></a>1、路径和工作目录</h3><p>从电子表格导入数据的第一步是找到包含数据的文件。我们需要让进行导入的R函数知道在哪里查找包含数据的文件。最简单的方法是在默认情况下在其中具有导入功能的文件夹中拥有该文件的副本。完成此操作后，我们只需提供文件名即可。</p>
<p>包含美国谋杀数据的电子表格包含在<strong>dslabs</strong>软件包中。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">filename &lt;- <span class="hljs-string">&quot;murders.csv&quot;</span><br>dir &lt;- system.file(<span class="hljs-string">&quot;extdata&quot;</span>, package = <span class="hljs-string">&quot;dslabs&quot;</span>) <br>fullpath &lt;- file.path(dir, filename)<br>file.copy(fullpath, <span class="hljs-string">&quot;murders.csv&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>该代码不会将数据读入R，而只是复制一个文件。一旦文件被复制，可以用简单的代码行导入数据。<code>read_csv</code>函数在<strong>readr</strong>包中，这是tidyverse的部分。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">library(tidyverse)<br>dat &lt;- read_csv(filename)<br></code></pre></td></tr></table></figure>

<p>数据被导入并存储在中<code>dat</code>。</p>
<h4 id="1-1、文件系统"><a href="#1-1、文件系统" class="headerlink" title="1.1、文件系统"></a>1.1、文件系统</h4><p>将计算机的文件系统视为一系列嵌套的文件夹，每个文件夹包含其他文件夹和文件。数据科学家将文件夹称为<em>目录</em>。将包含所有其他文件夹的文件夹称为<em>根目录</em>。将当前所在的<em>目录</em>称为<em>工作目录</em>。因此，工作目录在您移动文件夹时会发生变化：将其视为当前位置。</p>
<h4 id="1-2相对路径和完整路径"><a href="#1-2相对路径和完整路径" class="headerlink" title="1.2相对路径和完整路径"></a>1.2相对路径和完整路径</h4><p>文件的<em>路径</em>是目录名称的列表，可以将其视为有关单击哪些文件夹以及以什么顺序查找文件的说明。如果这些说明是用于从根目录中查找文件，则将其称为<em>完整路径</em>。如果有关从工作目录开始查找文件的说明，则将其称为<em>相对路径</em>。</p>
<p>要查看系统上完整路径的示例，则输入以下内容：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">system.file(package = <span class="hljs-string">&quot;dslabs&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>用斜杠分隔的字符串是目录名称。第一个斜杠代表根目录，如果出现的第一个目录名称前面没有斜杠，则假定该路径是相对路径。我们可以使用该函数<code>list.files</code>查看相对路径的示例。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">dir &lt;- system.file(package = <span class="hljs-string">&quot;dslabs&quot;</span>)<br>list.files(path = dir)<br><span class="hljs-comment">#&gt;  [1] &quot;data&quot;        &quot;DESCRIPTION&quot; &quot;extdata&quot;     &quot;help&quot;       </span><br><span class="hljs-comment">#&gt;  [5] &quot;html&quot;        &quot;INDEX&quot;       &quot;Meta&quot;        &quot;NAMESPACE&quot;  </span><br><span class="hljs-comment">#&gt;  [9] &quot;R&quot;           &quot;script&quot;</span><br></code></pre></td></tr></table></figure>

<p>如果从具有完整路径的目录开始，这些相对路径将为我们提供文件或目录的位置。例如，上例中<code>help</code>目录的完整路径为<code>/Library/Frameworks/R.framework/Versions/3.5/Resources/library/dslabs/help</code>。</p>
<h4 id="1-3、工作目录"><a href="#1-3、工作目录" class="headerlink" title="1.3、工作目录"></a>1.3、工作目录</h4><p>建议仅在代码中编写相对路径。原因是完整路径对于您的计算机是唯一的，并且代码可移植。可以使用<code>getwd</code>函数来获得工作目录的完整路径，而无需显式写出。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">wd &lt;- getwd()<br></code></pre></td></tr></table></figure>

<p>如果需要更改工作目录，则可以使用该功能<code>setwd</code>，也可以通过RStudio通过单击“会话”来更改它。</p>
<h4 id="1-4、生成路径名"><a href="#1-4、生成路径名" class="headerlink" title="1.4、生成路径名"></a>1.4、生成路径名</h4><p>创建对象时，上面给出了另一个获取完整路径而不显式写出示例的示例<code>fullpath</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">filename &lt;- <span class="hljs-string">&quot;murders.csv&quot;</span><br>dir &lt;- system.file(<span class="hljs-string">&quot;extdata&quot;</span>, package = <span class="hljs-string">&quot;dslabs&quot;</span>) <br>fullpath &lt;- file.path(dir, filename)<br></code></pre></td></tr></table></figure>

<p>该函数<code>system.file</code>提供文件夹的完整路径，该文件夹包含与<code>package</code>参数指定的包相关的所有文件和目录。通过浏览其中的目录，<code>dir</code>我们发现<code>extdata</code>包含了我们想要的文件：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">dir &lt;- system.file(package = <span class="hljs-string">&quot;dslabs&quot;</span>) <br>filename %in% list.files(file.path(dir, <span class="hljs-string">&quot;extdata&quot;</span>)) <br><span class="hljs-comment">#&gt; [1] TRUE</span><br></code></pre></td></tr></table></figure>

<p><code>system.file</code>函数允许我们提供子目录作为第一个参数，可以<code>extdata</code>像以下方式获取目录的完整路径：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">dir &lt;- system.file(<span class="hljs-string">&quot;extdata&quot;</span>, package = <span class="hljs-string">&quot;dslabs&quot;</span>) <br></code></pre></td></tr></table></figure>

<p>函数<code>file.path</code>用于合并目录名称，以生成要导入的文件的完整路径。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">fullpath &lt;- file.path(dir, filename)<br></code></pre></td></tr></table></figure>

<h4 id="1-5、使用路径复制文件"><a href="#1-5、使用路径复制文件" class="headerlink" title="1.5、使用路径复制文件"></a>1.5、使用路径复制文件</h4><p>我们用于将文件复制到主目录中的最后一行代码使用<br>函数<code>file.copy</code>。该函数有两个参数：要复制的文件和在新目录中赋予它的名称。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">file.copy(fullpath, <span class="hljs-string">&quot;murders.csv&quot;</span>)<br><span class="hljs-comment">#&gt; [1] TRUE</span><br></code></pre></td></tr></table></figure>

<p>如果文件复制成功，<code>file.copy</code>函数将返回<code>TRUE</code>。请注意，我们给文件起了相同的名称<code>murders.csv</code>，也可以给它起任何名字。还要注意，通过不以斜杠开头的字符串，R假定这是相对路径，并将文件复制到工作目录。</p>
<p>要在工作目录中看到该文件，可以使用以下命令进行检查：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">list.files()<br></code></pre></td></tr></table></figure>

<h3 id="2、readr和readxl软件包"><a href="#2、readr和readxl软件包" class="headerlink" title="2、readr和readxl软件包"></a>2、readr和readxl软件包</h3><p><strong>dslabs</strong>软件包提供了文件<code>murders.csv</code>。将文件复制到工作目录中：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">filename &lt;- <span class="hljs-string">&quot;murders.csv&quot;</span><br>dir &lt;- system.file(<span class="hljs-string">&quot;extdata&quot;</span>, package = <span class="hljs-string">&quot;dslabs&quot;</span>) <br>fullpath &lt;- file.path(dir, filename)<br>file.copy(fullpath, <span class="hljs-string">&quot;murders.csv&quot;</span>)<br></code></pre></td></tr></table></figure>

<h4 id="2-1、阅读器"><a href="#2-1、阅读器" class="headerlink" title="2.1、阅读器"></a>2.1、阅读器</h4><p><strong>readr</strong>库包括用于读取存储在文本文件中的电子表格到R.数据功能<strong>readr</strong>是的一部分<strong>tidyverse</strong>包，或者可以直接加载：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">library(readr)<br></code></pre></td></tr></table></figure>

<p>以下功能可用于读入电子表格：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>格式</th>
<th>典型后缀</th>
</tr>
</thead>
<tbody><tr>
<td>read_table</td>
<td>空格分隔值</td>
<td>文本文件</td>
</tr>
<tr>
<td>read_csv</td>
<td>逗号分隔值</td>
<td>CSV</td>
</tr>
<tr>
<td>read_csv2</td>
<td>分号分隔的值</td>
<td>CSV</td>
</tr>
<tr>
<td>read_tsv</td>
<td>制表符分隔的分隔值</td>
<td>电视</td>
</tr>
<tr>
<td>read_delim</td>
<td>通用文本文件格式，必须定义定界符</td>
<td>文本文件</td>
</tr>
</tbody></table>
<p>尽管后缀通常告诉我们文件的类型，但是不能保证它们始终匹配。可以打开文件进行查看或使用函数<code>read_lines</code>查看以下几行：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">read_lines(<span class="hljs-string">&quot;murders.csv&quot;</span>, n_max = <span class="hljs-number">3</span>)<br><span class="hljs-comment">#&gt; [1] &quot;state,abb,region,population,total&quot;</span><br><span class="hljs-comment">#&gt; [2] &quot;Alabama,AL,South,4779736,135&quot;     </span><br><span class="hljs-comment">#&gt; [3] &quot;Alaska,AK,West,710231,19&quot;</span><br></code></pre></td></tr></table></figure>

<p>这也表明存在标题。可以使用<code>read_csv</code>将数据读入R：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs R">dat &lt;- read_csv(filename)<br><span class="hljs-comment">#&gt; Parsed with column specification:</span><br><span class="hljs-comment">#&gt; cols(</span><br><span class="hljs-comment">#&gt;   state = col_character(),</span><br><span class="hljs-comment">#&gt;   abb = col_character(),</span><br><span class="hljs-comment">#&gt;   region = col_character(),</span><br><span class="hljs-comment">#&gt;   population = col_double(),</span><br><span class="hljs-comment">#&gt;   total = col_double()</span><br><span class="hljs-comment">#&gt; )</span><br></code></pre></td></tr></table></figure>

<p><code>dat</code>是一个<code>tibble</code>，而不仅仅是数据帧，因为<code>read_csv</code>是<strong>tidyverse</strong>解析器。通过以下方式确认数据已被读入：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">View(dat)<br></code></pre></td></tr></table></figure>

<p>还可以使用文件的完整路径：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">dat &lt;- read_csv(fullpath)<br></code></pre></td></tr></table></figure>

<h4 id="2-2、readxl"><a href="#2-2、readxl" class="headerlink" title="2.2、readxl"></a>2.2、readxl</h4><p>使用以下方式加载<strong>readxl</strong>软件包：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">library(readxl)<br></code></pre></td></tr></table></figure>

<p>该软件包提供了读取Microsoft Excel格式的功能：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>格式</th>
<th>典型后缀</th>
</tr>
</thead>
<tbody><tr>
<td>read_excel</td>
<td>自动检测格式</td>
<td>xls，xlsx</td>
</tr>
<tr>
<td>read_xls</td>
<td>原始格式</td>
<td>xls</td>
</tr>
<tr>
<td>read_xlsx</td>
<td>新格式</td>
<td>xlsx</td>
</tr>
</tbody></table>
<p>Microsoft Excel格式允许您在一个文件中包含多个电子表格。这些被称为工作<em>表</em>。上面列出的功能默认情况下会读取第一页，但也可以阅读其他功能。<code>excel_sheets</code>函数提供Excel文件中所有工作表的名称。然后，可以将这些名称传递给上述<code>sheet</code>三个函数中的参数，以读取除第一个以外的工作表。</p>
<h3 id="3、下载文件"><a href="#3、下载文件" class="headerlink" title="3、下载文件"></a>3、下载文件</h3><p>数据驻留的另一个常见位置是在Internet上。将这些数据保存在文件中后，我们可以下载它们，然后将其导入，甚至直接从Web上读取它们。例如，我们注意到，由于<strong>dslabs</strong>软件包位于GitHub上，因此我们随该软件包下载的文件具有url：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">url &lt;- <span class="hljs-string">&quot;https://raw.githubusercontent.com/rafalab/dslabs/master/inst/</span><br><span class="hljs-string">extdata/murders.csv&quot;</span><br></code></pre></td></tr></table></figure>

<p>该<code>read_csv</code>文件可以直接读取以下文件：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">dat &lt;- read_csv(url)<br></code></pre></td></tr></table></figure>

<p>如果要获得文件的本地副本，可以使用以下<code>download.file</code>功能：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">download.file(url, <span class="hljs-string">&quot;murders.csv&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>这将下载文件，并使用名称将其保存在您的系统上<code>murders.csv</code>。您可以在此处使用任何名称，而不必使用<code>murders.csv</code>。请注意，使用<code>download.file</code>时要小心，因为<strong>它会覆盖现有文件而不会发出警告</strong>。</p>
<p>从Internet下载数据有时有用的两个功能是<code>tempdir</code>和<code>tempfile</code>。第一个创建具有随机名称的目录，该名称很可能是唯一的。同样，<code>tempfile</code>创建一个字符串（而不是文件），该字符串很可能是唯一的文件名。因此，您可以运行以下命令，该命令在导入数据后会删除临时文件：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">tmp_filename &lt;- tempfile()<br>download.file(url, tmp_filename)<br>dat &lt;- read_csv(tmp_filename)<br>file.remove(tmp_filename)<br></code></pre></td></tr></table></figure>

<h3 id="4、R库导入功能"><a href="#4、R库导入功能" class="headerlink" title="4、R库导入功能"></a>4、R库导入功能</h3><p>R-base还提供导入功能。这些具有相似的名称那些在<strong>tidyverse</strong>，例如<code>read.table</code>，<code>read.csv</code>和<code>read.delim</code>。但是，有两个重要的区别。为了说明这一点，我们使用基于R的函数读入数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">dat2 &lt;- read.csv(filename)<br></code></pre></td></tr></table></figure>

<p>一个重要的区别是字符被转换为因子：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-built_in">class</span>(dat2$abb)<br><span class="hljs-comment">#&gt; [1] &quot;factor&quot;</span><br><span class="hljs-built_in">class</span>(dat2$region)<br><span class="hljs-comment">#&gt; [1] &quot;factor&quot;</span><br></code></pre></td></tr></table></figure>

<p>这可以通过设置参数来避免<code>stringsAsFactors</code>到<code>FALSE</code>。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs R">dat &lt;- read.csv(<span class="hljs-string">&quot;murders.csv&quot;</span>, stringsAsFactors = <span class="hljs-literal">FALSE</span>)<br><span class="hljs-built_in">class</span>(dat$state)<br><span class="hljs-comment">#&gt; [1] &quot;character&quot;</span><br></code></pre></td></tr></table></figure>

<p>这可能会引起混乱，因为在文件中另存为字符的变量将转换为因子，而不管变量代表什么。实际上，可以设置<code>stringsAsFactors=FALSE</code>为使用R基解析器时的默认方法。导入数据后，可以轻松地将所需的列转换为因子。</p>
<h4 id="4-1、-scan"><a href="#4-1、-scan" class="headerlink" title="4.1、 scan"></a>4.1、 <code>scan</code></h4><p>在电子表格中阅读时，很多事情都会出错。该文件可能具有多行标头，缺少单元格，或者可能使用了意外的编码。</p>
<p>有关以下常见问题的帖子：<a target="_blank" rel="noopener" href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">https</a> : <a target="_blank" rel="noopener" href="https://www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about-unicode-and-character-sets-no-excuses/">//www.joelonsoftware.com/2003/10/08/the-absolute-minimum-every-software-developer-absolutely-positively-must-know-about- Unicode和字符集无借口/</a>。</p>
<p>使用扫描可以读入文件的每个单元格。比如：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">path &lt;- system.file(<span class="hljs-string">&quot;extdata&quot;</span>, package = <span class="hljs-string">&quot;dslabs&quot;</span>)<br>filename &lt;- <span class="hljs-string">&quot;murders.csv&quot;</span><br>x &lt;- scan(file.path(path, filename), sep=<span class="hljs-string">&quot;,&quot;</span>, what = <span class="hljs-string">&quot;c&quot;</span>)<br>x[<span class="hljs-number">1</span>:<span class="hljs-number">10</span>]<br><span class="hljs-comment">#&gt;  [1] &quot;state&quot;      &quot;abb&quot;        &quot;region&quot;     &quot;population&quot; &quot;total&quot;     </span><br><span class="hljs-comment">#&gt;  [6] &quot;Alabama&quot;    &quot;AL&quot;         &quot;South&quot;      &quot;4779736&quot;    &quot;135&quot;</span><br></code></pre></td></tr></table></figure>

<p>tidyverse提供<code>read_lines</code>了相似有用的功能。</p>
<h3 id="5、文本文件与二进制文件"><a href="#5、文本文件与二进制文件" class="headerlink" title="5、文本文件与二进制文件"></a>5、文本文件与二进制文件</h3><p>从存储为文本文件的电子表格中提取数据可能是将数据从文件导入R会话的最简单方法。但是电子表格并不总是可用，可以查看文本文件这一事实并不一定意味着从它们中提取数据将很简单。</p>
<h3 id="6、-Unicode与ASCII"><a href="#6、-Unicode与ASCII" class="headerlink" title="6、 Unicode与ASCII"></a>6、 Unicode与ASCII</h3><p>实际上，数据科学的一个缺陷是假设文件是ASCII文本文件，而实际上它是另一个看起来很像ASCII文本文件的东西：Unicode文本文件。</p>
<p>计算机上的所有内容最终都需要转换为0和1。ASCII是一种将字符映射到数字的<em>编码</em>。ASCII使用7位（0和1）来产生唯一项，足以对英语键盘上的所有字符进行编码。但是，其他语言使用的字符不包含在此编码中。例如，墨西哥的é并非由ASCII编码。因此，定义了一种使用7位以上的新编码：Unicode。使用Unicode时，可以在8位，16位和32位（分别缩写为UTF-8，UTF-16和UTF-32）之间进行选择。RStudio实际上默认为UTF-8编码。2 7 = 12827=128</p>
<p>关于StackOverflow的讨论：<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/18789330/r-on-windows-character-encoding-hell">https</a> : <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/18789330/r-on-windows-character-encoding-hell">//stackoverflow.com/questions/18789330/r-on-windows-character-encoding-hell</a>。</p>
<h4 id="7、使用电子表格组织数据"><a href="#7、使用电子表格组织数据" class="headerlink" title="7、使用电子表格组织数据"></a>7、使用电子表格组织数据</h4><p>需要注意：</p>
<ul>
<li><strong>保持一致</strong> -在开始输入数据之前，请制定一个计划。一旦有了计划，请保持一致并坚持下去。</li>
<li><strong>选择事物的好名称</strong> -您希望为对象，文件和目录选择的名称易于记忆，易于拼写和描述。这实际上是很难达到的平衡，并且确实需要时间和思想。要遵循的一个重要规则是<strong>不要使用空格</strong>，而应使用下划线<code>_</code>或破折号<code>-</code>。另外，避免使用符号；坚持字母和数字。</li>
<li>**将日期写为YYYY-MM-DD-**为避免混淆，使用此全局ISO 8601标准。</li>
<li><strong>没有空单元格</strong> -填写所有单元格，并使用一些通用代码处理丢失的数据。</li>
<li><strong>在单元格中放一件事</strong> -最好添加列以存储额外的信息，而不是在一个单元格中包含多个信息。</li>
<li><strong>设为矩形</strong> -电子表格应为矩形。</li>
<li><strong>创建数据字典</strong> -如果您需要解释事物，例如列是什么或用于分类变量的标签是什么，请在单独的文件中执行此操作。</li>
<li><strong>原始数据文件中无计算</strong> -Excel允许您执行计算。不要将此部分放在电子表格中。计算代码应在脚本中。</li>
<li><strong>不要将字体颜色或突出显示用作数据</strong> -大多数导入功能无法导入此信息。而是将此信息编码为变量。</li>
<li><strong>进行备份</strong> -定期备份数据。</li>
<li><strong>使用数据验证来避免错误</strong> -利用电子表格软件中的工具，以使该过程尽可能没有错误，并且不会造成重复应力伤害。</li>
<li><strong>将数据另存为文本文件</strong> -以逗号或制表符分隔格式保存文件以供共享。</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>R语言学习笔记</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a target="_blank" rel="noopener" href="http://bramberrr.github.io/2020/05/03/NOTE/R语言学习笔记/">http://bramberrr.github.io/2020/05/03/NOTE/R语言学习笔记/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>Author</h><div class="post-copyright-cc-info"><h>B.X.</h></div></div><div class="post-copyright-c"><h>Release at</h><div class="post-copyright-cc-info"><h>2020-05-03</h></div></div><div class="post-copyright-u"><h>Update at</h><div class="post-copyright-cc-info"><h>2022-02-02</h></div></div><div class="post-copyright-c"><h>License</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/computer-science/">computer science</a><a class="post-meta__tags" href="/tags/data-science/">data science</a></div><div class="post_share"><div class="social-share" data-image="/img/R.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2021/08/17/INFO/hello-world/"><img class="prev-cover" src="/img/pic/hello-world-2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Resume</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Zhiwei Xu</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">5</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">6</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Bramberrr"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Bramberrr" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:bramberxu@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-calendar"><div class="card-content" style="height:320px;"><div class="item-headline"><i class="fas fa-comments"></i><span>Calendar</span></div><div class="calendar-app-container" id="hello-akilar" style="width:100%;padding:0.5px"><calendar-ui><div class="facemain"><figure><div><span class="face">睡觉ing</span><span class="face"><a href="javascript:void(0);" onclick="calendar_init()">要来和我聊聊么~</a></span></div></figure></div></calendar-ui></div></div></div><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#R%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">R语言学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#I-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">1.1.</span> <span class="toc-text">I 基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E8%B5%8B%E5%80%BC%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.1.1.</span> <span class="toc-text">一、赋值语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%9C%A8%E5%B7%A5%E4%BD%9C%E5%8C%BA%E6%93%8D%E4%BD%9C"><span class="toc-number">1.1.2.</span> <span class="toc-text">二、在工作区操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%A2%84%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.3.</span> <span class="toc-text">三、预定义函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%A2%84%E5%BB%BA%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.1.4.</span> <span class="toc-text">四、预建对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#II-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">II 数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%95%B0%E6%8D%AE%E5%B8%A7"><span class="toc-number">1.2.1.</span> <span class="toc-text">一、数据帧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%A3%80%E6%9F%A5%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.2.2.</span> <span class="toc-text">二、检查对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%AE%BF%E9%97%AE%E5%99%A8%EF%BC%9A"><span class="toc-number">1.2.3.</span> <span class="toc-text">三、访问器：$</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%90%91%E9%87%8F%EF%BC%9A%E6%95%B0%E5%AD%97%EF%BC%8C%E5%AD%97%E7%AC%A6%E5%92%8C%E9%80%BB%E8%BE%91"><span class="toc-number">1.2.4.</span> <span class="toc-text">四、向量：数字，字符和逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%9B%A0%E7%B4%A0"><span class="toc-number">1.2.5.</span> <span class="toc-text">五、因素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%88%97%E8%A1%A8"><span class="toc-number">1.2.6.</span> <span class="toc-text">六、列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E7%9F%A9%E9%98%B5"><span class="toc-number">1.2.7.</span> <span class="toc-text">七、矩阵</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#III-%E5%90%91%E9%87%8F%E4%B8%8E%E5%BC%BA%E5%88%B6"><span class="toc-number">1.3.</span> <span class="toc-text">III 向量与强制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%9B%E5%BB%BA%E5%90%91%E9%87%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text">一、创建向量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%90%8D%E7%A7%B0"><span class="toc-number">1.3.2.</span> <span class="toc-text">二、名称</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%BA%8F%E5%88%97"><span class="toc-number">1.3.3.</span> <span class="toc-text">三、序列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%AD%90%E9%9B%86"><span class="toc-number">1.3.4.</span> <span class="toc-text">四、子集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%BC%BA%E5%88%B6"><span class="toc-number">1.3.5.</span> <span class="toc-text">五、强制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IV-%E6%8E%92%E5%BA%8F"><span class="toc-number">1.4.</span> <span class="toc-text">IV 排序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81-sort"><span class="toc-number">1.4.1.</span> <span class="toc-text">一、 sort</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81order"><span class="toc-number">1.4.2.</span> <span class="toc-text">二、order</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81-max%E5%92%8Cwhich-max"><span class="toc-number">1.4.3.</span> <span class="toc-text">三、 max和which.max</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81rank"><span class="toc-number">1.4.4.</span> <span class="toc-text">四、rank</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%9B%9E%E6%94%B6"><span class="toc-number">1.4.5.</span> <span class="toc-text">五、回收</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#V-%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="toc-number">1.5.</span> <span class="toc-text">V 数学运算</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%87%8D%E6%96%B0%E7%BC%A9%E6%94%BE%E5%90%91%E9%87%8F"><span class="toc-number">1.5.1.</span> <span class="toc-text">一、重新缩放向量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%8F%8C%E5%90%91%E9%87%8F%E8%BF%90%E7%AE%97"><span class="toc-number">1.5.2.</span> <span class="toc-text">二、双向量运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VI-%E7%B4%A2%E5%BC%95"><span class="toc-number">1.6.</span> <span class="toc-text">VI 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%94%A8%E9%80%BB%E8%BE%91%E5%AD%90%E9%9B%86"><span class="toc-number">1.6.1.</span> <span class="toc-text">一、用逻辑子集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.6.2.</span> <span class="toc-text">二、逻辑运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81-which"><span class="toc-number">1.6.3.</span> <span class="toc-text">三、 which</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81match"><span class="toc-number">1.6.4.</span> <span class="toc-text">四、match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94-in"><span class="toc-number">1.6.5.</span> <span class="toc-text">五 %in%</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VII-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">1.7.</span> <span class="toc-text">VII 基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.7.1.</span> <span class="toc-text">一、条件表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-number">1.7.2.</span> <span class="toc-text">二、定义函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">1.7.3.</span> <span class="toc-text">三、命名空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81For%E5%BE%AA%E7%8E%AF"><span class="toc-number">1.7.4.</span> <span class="toc-text">四、For循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%90%91%E9%87%8F%E5%8C%96%E5%92%8C%E5%87%BD%E6%95%B0"><span class="toc-number">1.7.5.</span> <span class="toc-text">五、向量化和函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VIII-idyverse"><span class="toc-number">1.8.</span> <span class="toc-text">VIII idyverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%95%B4%E7%90%86%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.1.</span> <span class="toc-text">一、整理数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E5%B8%A7"><span class="toc-number">1.8.2.</span> <span class="toc-text">二、处理数据帧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%BD%BF%E7%94%A8%E6%B7%BB%E5%8A%A0%E5%88%97mutate"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">1、使用添加列mutate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%AD%90%E9%9B%86filter"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">2、子集filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81select"><span class="toc-number">1.8.2.3.</span> <span class="toc-text">3、select</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%AE%A1%E9%81%93%EF%BC%9A-gt"><span class="toc-number">1.8.3.</span> <span class="toc-text">三、管道：%&gt;%</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%B1%87%E6%80%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.4.</span> <span class="toc-text">四、汇总数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81-summarize"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">1、 summarize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81-pull"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">2、 pull</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%85%88%E5%88%86%E7%BB%84%E7%84%B6%E5%90%8E%E6%B1%87%E6%80%BBgroup-by"><span class="toc-number">1.8.5.</span> <span class="toc-text">3、先分组然后汇总group_by</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%8E%92%E5%BA%8F%E6%95%B0%E6%8D%AE%E6%A1%86"><span class="toc-number">1.8.6.</span> <span class="toc-text">五、排序数据框</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%B5%8C%E5%A5%97%E6%8E%92%E5%BA%8F"><span class="toc-number">1.8.6.1.</span> <span class="toc-text">1、嵌套排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81top-n"><span class="toc-number">1.8.6.2.</span> <span class="toc-text">2、top_n</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%B0%8F%E6%A0%87%E9%A2%98"><span class="toc-number">1.8.7.</span> <span class="toc-text">六、小标题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%B0%8F%E6%A0%87%E9%A2%98%E6%98%BE%E7%A4%BA%E6%95%88%E6%9E%9C%E6%9B%B4%E5%A5%BD"><span class="toc-number">1.8.7.1.</span> <span class="toc-text">1、小标题显示效果更好</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%B0%8F%E6%A0%87%E9%A2%98%E7%9A%84%E5%AD%90%E9%9B%86%E6%98%AF%E5%B0%8F%E6%A0%87%E9%A2%98"><span class="toc-number">1.8.7.2.</span> <span class="toc-text">2、小标题的子集是小标题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E5%B0%8F%E6%A0%87%E9%A2%98%E5%8F%AF%E4%BB%A5%E5%8C%85%E5%90%AB%E5%A4%8D%E6%9D%82%E7%9A%84%E6%9D%A1%E7%9B%AE"><span class="toc-number">1.8.7.3.</span> <span class="toc-text">3、小标题可以包含复杂的条目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E5%B0%8F%E6%A0%87%E9%A2%98%E5%8F%AF%E4%BB%A5%E5%88%86%E7%BB%84"><span class="toc-number">1.8.7.4.</span> <span class="toc-text">4、小标题可以分组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E4%BD%BF%E7%94%A8tibble%E4%BB%A3%E6%9B%BF%E5%88%9B%E5%BB%BA%E5%B0%8F%E6%A0%87%E9%A2%98data-frame"><span class="toc-number">1.8.7.5.</span> <span class="toc-text">5、使用tibble代替创建小标题data.frame</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E7%82%B9%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.8.8.</span> <span class="toc-text">七、点运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81-do"><span class="toc-number">1.8.9.</span> <span class="toc-text">八、 do</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D%E3%80%81purrr%E5%8C%85"><span class="toc-number">1.8.10.</span> <span class="toc-text">九、purrr包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E3%80%81-Tidyverse%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.8.11.</span> <span class="toc-text">十、 Tidyverse条件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81-case-when"><span class="toc-number">1.8.11.1.</span> <span class="toc-text">1、 case_when</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81-between"><span class="toc-number">1.8.11.2.</span> <span class="toc-text">2、 between</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IX-%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">1.9.</span> <span class="toc-text">IX 导入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%B7%AF%E5%BE%84%E5%92%8C%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95"><span class="toc-number">1.9.1.</span> <span class="toc-text">1、路径和工作目录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">1.1、文件系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84%E5%92%8C%E5%AE%8C%E6%95%B4%E8%B7%AF%E5%BE%84"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">1.2相对路径和完整路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E3%80%81%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95"><span class="toc-number">1.9.1.3.</span> <span class="toc-text">1.3、工作目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4%E3%80%81%E7%94%9F%E6%88%90%E8%B7%AF%E5%BE%84%E5%90%8D"><span class="toc-number">1.9.1.4.</span> <span class="toc-text">1.4、生成路径名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5%E3%80%81%E4%BD%BF%E7%94%A8%E8%B7%AF%E5%BE%84%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6"><span class="toc-number">1.9.1.5.</span> <span class="toc-text">1.5、使用路径复制文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81readr%E5%92%8Creadxl%E8%BD%AF%E4%BB%B6%E5%8C%85"><span class="toc-number">1.9.2.</span> <span class="toc-text">2、readr和readxl软件包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E3%80%81%E9%98%85%E8%AF%BB%E5%99%A8"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">2.1、阅读器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81readxl"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">2.2、readxl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6"><span class="toc-number">1.9.3.</span> <span class="toc-text">3、下载文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81R%E5%BA%93%E5%AF%BC%E5%85%A5%E5%8A%9F%E8%83%BD"><span class="toc-number">1.9.4.</span> <span class="toc-text">4、R库导入功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1%E3%80%81-scan"><span class="toc-number">1.9.4.1.</span> <span class="toc-text">4.1、 scan</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E4%B8%8E%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"><span class="toc-number">1.9.5.</span> <span class="toc-text">5、文本文件与二进制文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81-Unicode%E4%B8%8EASCII"><span class="toc-number">1.9.6.</span> <span class="toc-text">6、 Unicode与ASCII</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E4%BD%BF%E7%94%A8%E7%94%B5%E5%AD%90%E8%A1%A8%E6%A0%BC%E7%BB%84%E7%BB%87%E6%95%B0%E6%8D%AE"><span class="toc-number">1.9.6.1.</span> <span class="toc-text">7、使用电子表格组织数据</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Zhiwei Xu</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'twikoo-2gmwub1154bebdd6',
      region: ''
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'twikoo-2gmwub1154bebdd6',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script data-pjax src="/js/bramber.js"></script><script defer src="/live2d-widget/autoload.js"></script><script async src="//at.alicdn.com/t/font_2264842_3izu8i5eoc2.js"></script><div class="aplayer no-destroy" data-id="773706761" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script src="https://npm.elemecdn.com/vue@2.6.11"></script><script src="/js/calendar.js"></script><script data-pjax src="/js/calendar_init.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="/img/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("https://gitcalendar.akilar.top/api?Bramberrr",['#ebedf0', '#f1f8ff', '#dbedff', '#c8e1ff', '#79b8ff', '#2188ff', '#0366d6', '#005cc5', '#044289', '#032f62', '#05264c'],'Bramberrr')
    }
  </script><!-- hexo injector body_end end --></body></html>